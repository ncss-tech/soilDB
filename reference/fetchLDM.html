<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Query data from Kellogg Soil Survey Laboratory Data Mart via Soil Data Access or local SQLite snapshot — fetchLDM • soilDB</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Query data from Kellogg Soil Survey Laboratory Data Mart via Soil Data Access or local SQLite snapshot — fetchLDM"><meta name="description" content="This function provides access to the Kellogg Soil Survey Laboratory Data Mart via Soil Data Access or a local SQLite snapshot. See details and examples for additional usage instructions."><meta property="og:description" content="This function provides access to the Kellogg Soil Survey Laboratory Data Mart via Soil Data Access or a local SQLite snapshot. See details and examples for additional usage instructions."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">soilDB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.8.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/fetchNASIS.html">fetchNASIS(from='pedons') Columns</a></li>
    <li><a class="dropdown-item" href="../articles/wcs-ssurgo.html">Map Unit Key Grids and Thematic Maps of Soil Survey Geographic (SSURGO) Data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncss-tech/soilDB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Query data from Kellogg Soil Survey Laboratory Data Mart via Soil Data Access or local SQLite snapshot</h1>
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/soilDB/blob/2.8.7/R/fetchLDM.R" class="external-link"><code>R/fetchLDM.R</code></a></small>
      <div class="d-none name"><code>fetchLDM.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function provides access to the Kellogg Soil Survey Laboratory Data Mart via Soil Data Access or a local SQLite snapshot. See details and examples for additional usage instructions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fetchLDM</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"pedlabsampnum"</span>,</span>
<span>  bycol <span class="op">=</span> <span class="st">"pedon_key"</span>,</span>
<span>  tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lab_physical_properties"</span>, <span class="st">"lab_chemical_properties"</span>,</span>
<span>    <span class="st">"lab_calculations_including_estimates_and_default_values"</span>, <span class="st">"lab_rosetta_Key"</span><span class="op">)</span>,</span>
<span>  WHERE <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  chunk.size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  ntries <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  layer_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"horizon"</span>, <span class="st">"layer"</span>, <span class="st">"reporting layer"</span><span class="op">)</span>,</span>
<span>  area_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ssa"</span>, <span class="st">"country"</span>, <span class="st">"state"</span>, <span class="st">"county"</span>, <span class="st">"mlra"</span>, <span class="st">"nforest"</span>, <span class="st">"npark"</span><span class="op">)</span>,</span>
<span>  prep_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>  analyzed_size_frac <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;2 mm"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>  dsn <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A vector of values to find in column specified by <code>what</code>, default <code>NULL</code> uses no constraints on <code>what</code></p></dd>


<dt id="arg-what">what<a class="anchor" aria-label="anchor" href="#arg-what"></a></dt>
<dd><p>A single column name from tables: <code>lab_combine_nasis_ncss</code>, <code>lab_webmap</code>, <code>lab_site</code>, <code>lab_pedon</code> or <code>lab_area</code>. Common choices include <code>pedlabsampnum</code> (Laboratory Pedon ID), <code>upedonid</code> (User Pedon ID), <code>corr_name</code> ('Correlated' Taxon Name), <code>samp_name</code> ('Sampled As' Taxon Name), or <code>area_code</code> (area symbol for specified <code>lab_area</code> records, see <code>area_type</code>).</p></dd>


<dt id="arg-bycol">bycol<a class="anchor" aria-label="anchor" href="#arg-bycol"></a></dt>
<dd><p>A single column name from <code>lab_layer</code> used for processing chunks; default: <code>"pedon_key"</code></p></dd>


<dt id="arg-tables">tables<a class="anchor" aria-label="anchor" href="#arg-tables"></a></dt>
<dd><p>A vector of table names; Default is <code>"lab_physical_properties"</code>, <code>"lab_chemical_properties"</code>, <code>"lab_calculations_including_estimates_and_default_values"</code>, and <code>"lab_rosetta_Key"</code>. May also include one or more of: <code>"lab_mir"</code>, <code>"lab_mineralogy_glass_count"</code>, <code>"lab_major_and_trace_elements_and_oxides"</code>, <code>"lab_xray_and_thermal"</code> but it will be necessary to select appropriate <code>prep_code</code> and <code>analyzed_size_frac</code> for your analysis (see <em>Details</em>).</p></dd>


<dt id="arg-where">WHERE<a class="anchor" aria-label="anchor" href="#arg-where"></a></dt>
<dd><p>character. A custom SQL WHERE clause, which overrides <code>x</code>, <code>what</code>, and <code>bycol</code>, such as <code>CASE WHEN corr_name IS NOT NULL THEN LOWER(corr_name) ELSE LOWER(samp_name) END = 'musick'</code></p></dd>


<dt id="arg-chunk-size">chunk.size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>Number of pedons per chunk (for queries that may exceed <code>maxJsonLength</code>)</p></dd>


<dt id="arg-ntries">ntries<a class="anchor" aria-label="anchor" href="#arg-ntries"></a></dt>
<dd><p>Number of tries (times to halve <code>chunk.size</code>) before returning <code>NULL</code>; default <code>3</code></p></dd>


<dt id="arg-layer-type">layer_type<a class="anchor" aria-label="anchor" href="#arg-layer-type"></a></dt>
<dd><p>Default: <code>"horizon"</code>, <code>"layer"</code>, and <code>"reporting layer"</code></p></dd>


<dt id="arg-area-type">area_type<a class="anchor" aria-label="anchor" href="#arg-area-type"></a></dt>
<dd><p>Default: <code>"ssa"</code> (Soil Survey Area). Other options include (choose one): <code>"country"</code>, <code>"state"</code>, <code>"county"</code>, <code>"mlra"</code> (Major Land Resource Area), <code>"nforest"</code> (National Forest), <code>"npark"</code> (National Park)</p></dd>


<dt id="arg-prep-code">prep_code<a class="anchor" aria-label="anchor" href="#arg-prep-code"></a></dt>
<dd><p>Default: <code>"S"</code> and <code>""</code>. May also include one or more of: <code>"F"</code>, <code>"HM"</code>, <code>"HM_SK"</code> <code>"GP"</code>, <code>"M"</code>, <code>"N"</code>, or <code>"S"</code></p></dd>


<dt id="arg-analyzed-size-frac">analyzed_size_frac<a class="anchor" aria-label="anchor" href="#arg-analyzed-size-frac"></a></dt>
<dd><p>Default: <code>"&lt;2 mm"</code> and <code>""</code>. May also include one or more of: <code>"&lt;0.002 mm"</code>, <code>"0.02-0.05 mm"</code>, <code>"0.05-0.1 mm"</code>, <code>"0.1-0.25 mm"</code>, <code>"0.25-0.5 mm"</code>, <code>"0.5-1 mm"</code>, <code>"1-2 mm"</code>, <code>"0.02-2 mm"</code>, <code>"0.05-2 mm"</code></p></dd>


<dt id="arg-dsn">dsn<a class="anchor" aria-label="anchor" href="#arg-dsn"></a></dt>
<dd><p>Data source name; either a path to a SQLite database, an open DBIConnection or (default) <code>NULL</code> (to use <code><a href="SDA_query.html">soilDB::SDA_query</a></code>)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <code>SoilProfileCollection</code> for a successful query, a <code>try-error</code> if no site/pedon locations can be found or <code>NULL</code> for an empty <code>lab_layer</code> (within sites/pedons) result</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>You can download SQLite or GeoPackage snapshots here: <a href="https://ncsslabdatamart.sc.egov.usda.gov/database_download.aspx" class="external-link">https://ncsslabdatamart.sc.egov.usda.gov/database_download.aspx</a>. Specify the <code>dsn</code> argument to use a local copy of the lab data rather than Soil Data Access web service.</p>
<p>Lab Data Mart model diagram: <a href="https://jneme910.github.io/Lab_Data_Mart_Documentation/Documents/SDA_KSSL_Data_model.html" class="external-link">https://jneme910.github.io/Lab_Data_Mart_Documentation/Documents/SDA_KSSL_Data_model.html</a>
If the <code>chunk.size</code> parameter is set too large and the Soil Data Access request fails, the algorithm will re-try the query with a smaller (halved) <code>chunk.size</code> argument. This will be attempted up to 3 times before returning <code>NULL</code></p>
<p>The default behavior joins the <code>lab_area</code> tables only for the "Soil Survey Area" related records. You can specify alternative area records for use in <code>x</code>, <code>what</code> or <code>WHERE</code> arguments by setting <code>area_type</code> to a different value.</p>
<p>When requesting data from <code>"lab_major_and_trace_elements_and_oxides"</code>, <code>"lab_mineralogy_glass_count"</code>, or <code>"lab_xray_and_thermal"</code> multiple preparation codes (<code>prep_code</code>) or size fractions (<code>analyzed_size_frac</code>) are possible. The default behavior of <code>fetchLDM()</code> is to attempt to return a topologically valid (minimal overlaps) <em>SoilProfileCollection</em>. This is achieved by setting <code>prep_code="S"</code> ("sieved") and <code>analyzed_size_frac="&lt;2 mm"</code>. You may specify alternate or additional preparation codes or fractions as needed, but note that this may cause "duplication" of some layers where measurements were made with different preparation or on fractionated samples</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># fetch by Soil Survey Area area symbol (area_code using default "ssa" area_type)</span></span></span>
<span class="r-in"><span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">fetchLDM</span><span class="op">(</span><span class="st">"CA630"</span>, what <span class="op">=</span> <span class="st">"area_code"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># fetch by Major Land Resource area symbol (area_code using "mlra" area_type)</span></span></span>
<span class="r-in"><span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">fetchLDM</span><span class="op">(</span><span class="st">"22A"</span>, what <span class="op">=</span> <span class="st">"area_code"</span>, area_type <span class="op">=</span> <span class="st">"mlra"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># fetch by multiple case-insensitive taxon name</span></span></span>
<span class="r-in"><span>  <span class="co"># (correlated or sampled as Musick or Holland series)</span></span></span>
<span class="r-in"><span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">fetchLDM</span><span class="op">(</span>WHERE <span class="op">=</span> <span class="st">"(CASE WHEN corr_name IS NOT NULL </span></span></span>
<span class="r-in"><span><span class="st">                                THEN LOWER(corr_name) </span></span></span>
<span class="r-in"><span><span class="st">                                ELSE LOWER(samp_name) </span></span></span>
<span class="r-in"><span><span class="st">                            END) IN ('musick', 'holland')"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># physical properties of soils correlated as taxonomic subgroup "Typic Argialbolls"</span></span></span>
<span class="r-in"><span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">fetchLDM</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Typic Argialbolls"</span>, </span></span>
<span class="r-in"><span>                  what <span class="op">=</span> <span class="st">"corr_taxsubgrp"</span>, </span></span>
<span class="r-in"><span>                  tables <span class="op">=</span> <span class="st">"lab_physical_properties"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker, Andrew Brown.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

