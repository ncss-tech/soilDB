<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Query data from Kellogg Soil Survey Laboratory Data Mart via Soil Data Access or local SQLite snapshot — fetchLDM • soilDB</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Query data from Kellogg Soil Survey Laboratory Data Mart via Soil Data Access or local SQLite snapshot — fetchLDM"><meta property="og:description" content="LDM model diagram: https://jneme910.github.io/Lab_Data_Mart_Documentation/Documents/SDA_KSSL_Data_model.html"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">soilDB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.6.14</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ncss-tech/soilDB/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Query data from Kellogg Soil Survey Laboratory Data Mart via Soil Data Access or local SQLite snapshot</h1>
    <small class="dont-index">Source: <a href="https://github.com/ncss-tech/soilDB/blob/HEAD/R/fetchLDM.R" class="external-link"><code>R/fetchLDM.R</code></a></small>
    <div class="hidden name"><code>fetchLDM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>LDM model diagram: <a href="https://jneme910.github.io/Lab_Data_Mart_Documentation/Documents/SDA_KSSL_Data_model.html" class="external-link">https://jneme910.github.io/Lab_Data_Mart_Documentation/Documents/SDA_KSSL_Data_model.html</a></p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">fetchLDM</span><span class="op">(</span>
  x <span class="op">=</span> <span class="cn">NULL</span>,
  what <span class="op">=</span> <span class="st">"pedlabsampnum"</span>,
  bycol <span class="op">=</span> <span class="st">"pedon_key"</span>,
  tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/combine-SoilProfileCollection-method.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lab_physical_properties"</span>, <span class="st">"lab_chemical_properties"</span>,
    <span class="st">"lab_calculations_including_estimates_and_default_values"</span>, <span class="st">"lab_rosetta_Key"</span><span class="op">)</span>,
  chunk.size <span class="op">=</span> <span class="fl">1000</span>,
  ntries <span class="op">=</span> <span class="fl">3</span>,
  layer_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/combine-SoilProfileCollection-method.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"horizon"</span>, <span class="st">"layer"</span>, <span class="st">"reporting layer"</span><span class="op">)</span>,
  prep_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/combine-SoilProfileCollection-method.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">""</span><span class="op">)</span>,
  analyzed_size_frac <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/combine-SoilProfileCollection-method.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;2 mm"</span>, <span class="st">""</span><span class="op">)</span>,
  dsn <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A vector of values to find in column specified by <code>what</code>, default <code>NULL</code> uses no constraints on <code>what</code></p></dd>
<dt>what</dt>
<dd><p>A single column name from tables: <code>lab_combine_nasis_ncss</code>, <code>lab_webmap</code>, <code>lab_site</code>, <code>lab_pedon</code> or <code>lab_area</code></p></dd>
<dt>bycol</dt>
<dd><p>A single column name from <code>lab_layer</code> used for processing chunks; default: <code>"pedon_key"</code></p></dd>
<dt>tables</dt>
<dd><p>A vector of table names; Default is <code>"lab_physical_properties"</code>, <code>"lab_chemical_properties"</code>, <code>"lab_calculations_including_estimates_and_default_values"</code>, and <code>"lab_rosetta_Key"</code>. May also include one or more of: <code>"lab_mir"</code>, <code>"lab_mineralogy_glass_count"</code>, <code>"lab_major_and_trace_elements_and_oxides"</code>, <code>"lab_xray_and_thermal"</code> but it will be necessary to select appropriate <code>prep_code</code> and <code>analyzed_size_frac</code> for your analysis (see <em>Details</em>).</p></dd>
<dt>chunk.size</dt>
<dd><p>Number of pedons per chunk (for queries that may exceed <code>maxJsonLength</code>)</p></dd>
<dt>ntries</dt>
<dd><p>Number of tries (times to halve <code>chunk.size</code>) before returning <code>NULL</code>; default <code>3</code></p></dd>
<dt>layer_type</dt>
<dd><p>Default: <code>"horizon"</code>, <code>"layer"</code>, and <code>"reporting layer"</code></p></dd>
<dt>prep_code</dt>
<dd><p>Default: <code>"S"</code> and <code>""</code>. May also include one or more of: <code>"F"</code>, <code>"HM"</code>, <code>"HM_SK"</code> <code>"GP"</code>, <code>"M"</code>, <code>"N"</code>, or <code>"S"</code></p></dd>
<dt>analyzed_size_frac</dt>
<dd><p>Default: <code>"&lt;2 mm"</code> and <code>""</code>. May also include one or more of: <code>"&lt;0.002 mm"</code>, <code>"0.02-0.05 mm"</code>, <code>"0.05-0.1 mm"</code>, <code>"0.1-0.25 mm"</code>, <code>"0.25-0.5 mm"</code>, <code>"0.5-1 mm"</code>, <code>"1-2 mm"</code>, <code>"0.02-2 mm"</code>, <code>"0.05-2 mm"</code></p></dd>
<dt>dsn</dt>
<dd><p>Data source name; either a path to a SQLite database, an open DBIConnection or (default) <code>NULL</code> (to use <code><a href="SDA_query.html">soilDB::SDA_query</a></code>)</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>a <code>SoilProfileCollection</code> for a successful query, a <code>try-error</code> if no site/pedon locations can be found or <code>NULL</code> for an empty <code>lab_layer</code> (within sites/pedons) result</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>If the <code>chunk.size</code> parameter is set too large and the Soil Data Access request fails, the algorithm will re-try the query with a smaller (halved) <code>chunk.size</code> argument. This will be attempted up to 3 times before returning <code>NULL</code></p>
<p>Currently the <code>lab_area</code> tables are joined only for the "Soil Survey Area" related records.</p>
<p>When requesting data from <code>"lab_major_and_trace_elements_and_oxides"</code>, <code>"lab_mineralogy_glass_count"</code>, or <code>"lab_xray_and_thermal"</code> multiple preparation codes (<code>prep_code</code>) or size fractions (<code>analyzed_size_frac</code>) are possible. The default behavior of <code>fetchLDM()</code> is to attempt to return a topologically valid (minimal overlaps) <em>SoilProfileCollection</em>. This is achieved by setting <code>prep_code="S"</code> ("sieved") and <code>analyzed_size_frac="&lt;2 mm"</code>. You may specify alternate or additional preparation codes or fractions as needed, but note that this may cause "duplication" of some layers where measurements were made with different preparation or on fractionated samples</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"curl"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span class="r-in">   <span class="fu">curl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/curl/man/nslookup.html" class="external-link">has_internet</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># fetch by ssa_key</span></span>
<span class="r-in">  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">fetchLDM</span><span class="op">(</span><span class="fl">8297</span>, what <span class="op">=</span> <span class="st">"ssa_key"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># physical properties correlated as taxonomic subgroup "Typic Argialbolls"</span></span>
<span class="r-in">  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">fetchLDM</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Typic Argialbolls"</span>, </span>
<span class="r-in">                  what <span class="op">=</span> <span class="st">"corr_taxsubgrp"</span>, </span>
<span class="r-in">                  tables <span class="op">=</span> <span class="st">"lab_physical_properties"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="co"># fetch by area_code (SSA only)  </span></span>
<span class="r-in">  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">fetchLDM</span><span class="op">(</span><span class="st">"CA630"</span>, what <span class="op">=</span> <span class="st">"area_code"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker, Andrew Brown.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

