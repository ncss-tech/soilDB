<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Get Spatial Data from Soil Data Access by mukey, nationalmusym or areasymbol — fetchSDA_spatial • soilDB</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Spatial Data from Soil Data Access by mukey, nationalmusym or areasymbol — fetchSDA_spatial"><meta name="description" content="This method facilitates queries to Soil Data Access (SDA) mapunit and survey area geometry. Queries are generated based on map unit key (mukey) and national map unit symbol (nationalmusym) for mupolygon (SSURGO) or gsmmupolygon (STATSGO) geometry OR legend key (lkey) and area symbols (areasymbol) for sapolygon (Soil Survey Area; SSA) geometry).
A Soil Data Access query returns geometry and key identifying information about the map unit or area of interest. Additional columns from the map unit or legend table can be included; see add.fields argument."><meta property="og:description" content="This method facilitates queries to Soil Data Access (SDA) mapunit and survey area geometry. Queries are generated based on map unit key (mukey) and national map unit symbol (nationalmusym) for mupolygon (SSURGO) or gsmmupolygon (STATSGO) geometry OR legend key (lkey) and area symbols (areasymbol) for sapolygon (Soil Survey Area; SSA) geometry).
A Soil Data Access query returns geometry and key identifying information about the map unit or area of interest. Additional columns from the map unit or legend table can be included; see add.fields argument."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">soilDB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.8.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/fetchNASIS.html">fetchNASIS(from='pedons') Columns</a></li>
    <li><a class="dropdown-item" href="../articles/wcs-ssurgo.html">Map Unit Key Grids and Thematic Maps of Soil Survey Geographic (SSURGO) Data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncss-tech/soilDB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get Spatial Data from Soil Data Access by <code>mukey</code>, <code>nationalmusym</code> or <code>areasymbol</code></h1>
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/soilDB/blob/2.8.8/R/fetchSDA_spatial.R" class="external-link"><code>R/fetchSDA_spatial.R</code></a></small>
      <div class="d-none name"><code>fetchSDA_spatial.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This method facilitates queries to Soil Data Access (SDA) mapunit and survey area geometry. Queries are generated based on map unit key (<code>mukey</code>) and national map unit symbol (<code>nationalmusym</code>) for <code>mupolygon</code> (SSURGO) or <code>gsmmupolygon</code> (STATSGO) geometry OR legend key (<code>lkey</code>) and area symbols (<code>areasymbol</code>) for <code>sapolygon</code> (Soil Survey Area; SSA) geometry).</p>
<p>A Soil Data Access query returns geometry and key identifying information about the map unit or area of interest. Additional columns from the map unit or legend table can be included; see <code>add.fields</code> argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fetchSDA_spatial</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  by.col <span class="op">=</span> <span class="st">"mukey"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"feature"</span>,</span>
<span>  geom.src <span class="op">=</span> <span class="st">"mupolygon"</span>,</span>
<span>  db <span class="op">=</span> <span class="st">"SSURGO"</span>,</span>
<span>  add.fields <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  chunk.size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  as_Spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"soilDB.return_Spatial"</span>, default <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A vector of map unit keys (<code>mukey</code>) or national map unit symbols (<code>nationalmusym</code>) for <code>mupolygon</code>, <code>muline</code> or <code>mupoint</code>; feature keys (<code>featkey</code>) for <code>featpoint</code> and <code>featline</code>; legend keys (<code>lkey</code>) or soil survey area symbols (<code>areasymbol</code>) for <code>sapolygon</code> geometry. If <code>geom.src="mlrapolygon"</code> then <code>x</code> refers to <code>MLRARSYM</code> (major land resource area symbols).</p></dd>


<dt id="arg-by-col">by.col<a class="anchor" aria-label="anchor" href="#arg-by-col"></a></dt>
<dd><p>Column name containing map unit identifier <code>"mukey"</code>, <code>"nationalmusym"</code>, or <code>"ecoclassid"</code> for <code>geom.src</code> <code>mupolygon</code> OR <code>"areasymbol"</code>, <code>"areaname"</code>, <code>"mlraoffice"</code>, <code>"mouagncyresp"</code> for <code>geom.src</code> <code>sapolygon</code>; default is determined by <code>isTRUE(is.numeric(x))</code> for <code>mukey</code>, <code>featkey</code> or <code>lkey</code>, using <code>nationalmusym</code> or <code>areasymbol</code> otherwise.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>geometry result type: <code>"feature"</code> returns polygons, <code>"bbox"</code> returns the bounding box of each polygon (via <code>STEnvelope()</code>), <code>"point"</code> returns a single point (via <code>STPointOnSurface()</code>) within each polygon, <code>"extent"</code> returns an aggregate bounding box (the extent of all polygons, <code>geometry::EnvelopeAggregate()</code>) ), <code>"convexhull"</code> (<code>geometry::ConvexHullAggregate()</code>) returns the aggregate convex hull around all polygons, <code>"union"</code> (<code>geometry::UnionAggregate()</code>) and <code>"collection"</code> (<code>geometry::CollectionAggregate()</code>) return a <code>MULTIPOLYGON</code> or a <code>GEOMETRYCOLLECTION</code>, respectively, for each <code>mukey</code>, <code>nationalmusym</code>, or <code>areasymbol </code>. In the case of the latter four aggregation methods, the groups for aggregation depend on <code>by.col</code> (default by <code>"mukey"</code>).</p></dd>


<dt id="arg-geom-src">geom.src<a class="anchor" aria-label="anchor" href="#arg-geom-src"></a></dt>
<dd><p>Either <code>mupolygon</code> (map unit polygons), <code>muline</code> (map unit lines), <code>mupoint</code> (map unit points), <code>featpoint</code> (feature points), <code>featline</code> (feature lines), <code>sapolygon</code> (soil survey area boundary polygons), or <code>mlrapolygon</code> (major land resource area boundary polygons)</p></dd>


<dt id="arg-db">db<a class="anchor" aria-label="anchor" href="#arg-db"></a></dt>
<dd><p>Default: <code>"SSURGO"</code>. When <code>geom.src</code> is <code>mupolygon</code>, use STATSGO polygon geometry instead of SSURGO by setting <code>db = "STATSGO"</code></p></dd>


<dt id="arg-add-fields">add.fields<a class="anchor" aria-label="anchor" href="#arg-add-fields"></a></dt>
<dd><p>Column names from <code>mapunit</code> or <code>legend</code> table to add to result. Must specify parent table name as the prefix before column name e.g. <code>mapunit.muname</code>.</p></dd>


<dt id="arg-chunk-size">chunk.size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>Number of values of <code>x</code> to process per query. Necessary for large results. Default: <code>10</code></p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Print messages?</p></dd>


<dt id="arg-as-spatial">as_Spatial<a class="anchor" aria-label="anchor" href="#arg-as-spatial"></a></dt>
<dd><p>Return sp classes? e.g. <code>Spatial*DataFrame</code>. Default: <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>an <code>sf</code> data.frame corresponding to SDA spatial data for all symbols requested. If <code>as_Spatial=TRUE</code> returns a <code>Spatial*DataFrame</code> from the sp package via <code><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html" class="external-link">sf::as_Spatial()</a></code> for backward compatibility. Default result contains geometry with attribute table containing unique feature ID, symbol and area symbol plus additional fields in result specified with <code>add.fields</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function automatically "chunks" the input vector (using <code><a href="makeChunks.html">makeChunks()</a></code>) of map unit identifiers to minimize the likelihood of exceeding the SDA data request size. The number of chunks varies with the <code>chunk.size</code> setting and the length of your input vector. If you are working with many map units and/or large extents, you may need to decrease this number in order to have more chunks.</p>
<p>Querying regions with complex mapping may require smaller <code>chunk.size</code>. Numerically adjacent IDs in the input vector may share common qualities (say, all from same soil survey area or region) which could cause specific chunks to perform "poorly" (slow or error) no matter what the chunk size is. Shuffling the order of the inputs using <code><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample()</a></code> may help to eliminate problems related to this, depending on how you obtained your set of MUKEY/nationalmusym to query. One could feasibly use <code>muacres</code> as a heuristic to adjust for total acreage within chunks.</p>
<p>Note that STATSGO data are fetched where <code>CLIPAREASYMBOL = 'US'</code> to avoid duplicating state and national subsets of the geometry.</p>
<p>A prototype interface, <code>geom.src="mlrapolygon"</code>, is provided for obtaining Major Land Resource Area (MLRA) polygon
boundaries. When using this geometry source <code>x</code> is a vector of <code>MLRARSYM</code> (MLRA Symbols). The geometry source is
the MLRA Geographic Database v5.2 (2022) which is not (yet) part of Soil Data Access. Instead of SDA, GDAL utilities
are used to read a zipped ESRI Shapefile from a remote URL: <a href="https://www.nrcs.usda.gov/sites/default/files/2022-10/MLRA_52_2022.zip" class="external-link">https://www.nrcs.usda.gov/sites/default/files/2022-10/MLRA_52_2022.zip</a>.
Therefore, most additional <code>fetchSDA_spatial()</code> arguments are <em>not</em> currently supported for the MLRA geometry source.
In the future a <code>mlrapolygon</code> table may be added to SDA (analogous to  <code>mupolygon</code> and <code>sapolygon</code>),
and the function will be updated accordingly at that time.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Andrew G. Brown, Dylan E. Beaudette</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span>    <span class="co"># get spatial data for a single mukey</span></span></span>
<span class="r-in"><span>    <span class="va">single.mukey</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">fetchSDA_spatial</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"2924882"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 1 chunks...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Chunk #1 completed (n = 1; 0.1 secs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Done in 0.1 secs; mean/chunk: 0.1 secs; mean/symbol: 0.14 secs.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># demonstrate fetching full extent (multi-mukey) of national musym</span></span></span>
<span class="r-in"><span>    <span class="va">full.extent.nmusym</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">fetchSDA_spatial</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"2x8l5"</span>, by <span class="op">=</span> <span class="st">"nmusym"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 1 chunks...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Chunk #1 completed (n = 3; 0.7 secs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Done in 0.9 secs; mean/chunk: 0.7 secs; mean/symbol: 0.31 secs.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># compare extent of nmusym to single mukey within it</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">single.mukey</span>, <span class="st">'try-error'</span><span class="op">)</span> <span class="op">&amp;&amp;</span> </span></span>
<span class="r-in"><span>        <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">full.extent.nmusym</span>, <span class="st">'try-error'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        </span></span>
<span class="r-in"><span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"sf"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      </span></span>
<span class="r-in"><span>         <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">full.extent.nmusym</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"RED"</span>, border <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>         <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">single.mukey</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"BLUE"</span>, border <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>       </span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>        </span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-plt img"><img src="fetchSDA_spatial-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># demo adding a field (`muname`) to attribute table of result</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">fetchSDA_spatial</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"2x8l5"</span>, by<span class="op">=</span><span class="st">"nmusym"</span>, add.fields<span class="op">=</span><span class="st">"muname"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 1 chunks...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Chunk #1 completed (n = 3; 0.5 secs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Done in 0.7 secs; mean/chunk: 0.5 secs; mean/symbol: 0.23 secs.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 6 features and 4 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: POLYGON</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: -121.034 ymin: 38.01706 xmax: -120.9596 ymax: 38.24938</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geodetic CRS:  WGS 84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    mukey areasymbol nationalmusym                                        muname</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                             geom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 POLYGON ((-121.0226 38.2276...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 POLYGON ((-121.0141 38.2325...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 POLYGON ((-121.0339 38.2325...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 POLYGON ((-120.9955 38.0674...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 POLYGON ((-121.0102 38.1891...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 POLYGON ((-120.9648 38.0208...</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker, Andrew Brown.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

