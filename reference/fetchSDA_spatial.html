<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Get Spatial Data from Soil Data Access by mukey, nationalmusym or areasymbol — fetchSDA_spatial • soilDB</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Get Spatial Data from Soil Data Access by mukey, nationalmusym or areasymbol — fetchSDA_spatial"><meta property="og:description" content="This method facilitates queries to Soil Data Access (SDA) mapunit and survey area geometry. Queries are generated based on map unit key (mukey) and national map unit symbol (nationalmusym) for mupolygon (SSURGO) or gsmmupolygon (STATSGO) geometry OR legend key (lkey) and area symbols (areasymbol) for sapolygon (Soil Survey Area; SSA) geometry).
A Soil Data Access query returns geometry and key identifying information about the map unit or area of interest. Additional columns from the map unit or legend table can be included; see add.fields argument."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">soilDB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.7.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ncss-tech/soilDB/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Get Spatial Data from Soil Data Access by <code>mukey</code>, <code>nationalmusym</code> or <code>areasymbol</code></h1>
    <small class="dont-index">Source: <a href="https://github.com/ncss-tech/soilDB/blob/HEAD/R/fetchSDA_spatial.R" class="external-link"><code>R/fetchSDA_spatial.R</code></a></small>
    <div class="hidden name"><code>fetchSDA_spatial.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This method facilitates queries to Soil Data Access (SDA) mapunit and survey area geometry. Queries are generated based on map unit key (<code>mukey</code>) and national map unit symbol (<code>nationalmusym</code>) for <code>mupolygon</code> (SSURGO) or <code>gsmmupolygon</code> (STATSGO) geometry OR legend key (<code>lkey</code>) and area symbols (<code>areasymbol</code>) for <code>sapolygon</code> (Soil Survey Area; SSA) geometry).</p>
<p>A Soil Data Access query returns geometry and key identifying information about the map unit or area of interest. Additional columns from the map unit or legend table can be included; see <code>add.fields</code> argument.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fetchSDA_spatial</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  by.col <span class="op">=</span> <span class="st">"mukey"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"feature"</span>,</span>
<span>  geom.src <span class="op">=</span> <span class="st">"mupolygon"</span>,</span>
<span>  db <span class="op">=</span> <span class="st">"SSURGO"</span>,</span>
<span>  add.fields <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  chunk.size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  as_Spatial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"soilDB.return_Spatial"</span>, default <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A vector of map unit keys (<code>mukey</code>) or national map unit symbols (<code>nmusym</code>) for <code>mupolygon</code> geometry OR legend keys (<code>lkey</code>) or soil survey area symbols (<code>areasymbol</code>) for <code>sapolygon</code> geometry</p></dd>


<dt>by.col</dt>
<dd><p>Column name containing map unit identifier <code>"mukey"</code>, <code>"nmusym"</code>/<code>"nationalmusym"</code> for <code>geom.src</code> <code>mupolygon</code> OR <code>"areasymbol"</code>, <code>"areaname"</code>, <code>"mlraoffice"</code>, <code>"mouagncyresp"</code> for <code>geom.src</code> <code>sapolygon</code>; default is determined by <code>is.numeric(x)</code> <code>TRUE</code> for <code>mukey</code> or <code>lkey</code> and <code>nationalmusym</code> or <code>areasymbol</code> otherwise.</p></dd>


<dt>method</dt>
<dd><p>geometry result type: <code>"feature"</code> returns polygons, <code>"bbox"</code> returns the bounding box of each polygon (via <code>STEnvelope()</code>), and <code>"point"</code> returns a single point (via <code>STPointOnSurface()</code>) within each polygon.</p></dd>


<dt>geom.src</dt>
<dd><p>Either <code>mupolygon</code> (map unit polygons) or <code>sapolygon</code> (soil survey area boundary polygons)</p></dd>


<dt>db</dt>
<dd><p>Default: <code>"SSURGO"</code>. When <code>geom.src</code> is <code>mupolygon</code>, use STATSGO polygon geometry instead of SSURGO by setting <code>db = "STATSGO"</code></p></dd>


<dt>add.fields</dt>
<dd><p>Column names from <code>mapunit</code> or <code>legend</code> table to add to result. Must specify parent table name as the prefix before column name e.g. <code>mapunit.muname</code>.</p></dd>


<dt>chunk.size</dt>
<dd><p>Number of values of <code>x</code> to process per query. Necessary for large results. Default: <code>10</code></p></dd>


<dt>verbose</dt>
<dd><p>Print messages?</p></dd>


<dt>as_Spatial</dt>
<dd><p>Return sp classes? e.g. <code>Spatial*DataFrame</code>. Default: <code>FALSE</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>an <code>sf</code> data.frame corresponding to SDA spatial data for all symbols requested. If <code>as_Spatial=TRUE</code> returns a <code>Spatial*DataFrame</code> from the sp package via <code><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html" class="external-link">sf::as_Spatial()</a></code> for backward compatibility. Default result contains geometry with attribute table containing unique feature ID, symbol and area symbol plus additional fields in result specified with <code>add.fields</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function automatically "chunks" the input vector (using <code><a href="makeChunks.html">makeChunks()</a></code>) of map unit identifiers to minimize the likelihood of exceeding the SDA data request size. The number of chunks varies with the <code>chunk.size</code> setting and the length of your input vector. If you are working with many map units and/or large extents, you may need to decrease this number in order to have more chunks.</p>
<p>Querying regions with complex mapping may require smaller <code>chunk.size</code>. Numerically adjacent IDs in the input vector may share common qualities (say, all from same soil survey area or region) which could cause specific chunks to perform "poorly" (slow or error) no matter what the chunk size is. Shuffling the order of the inputs using <code><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample()</a></code> may help to eliminate problems related to this, depending on how you obtained your set of MUKEY/nationalmusym to query. One could feasibly use <code>muacres</code> as a heuristic to adjust for total acreage within chunks.</p>
<p>Note that STATSGO data are fetched where <code>CLIPAREASYMBOL = 'US'</code> to avoid duplicating state and national subsets of the geometry.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Andrew G. Brown, Dylan E. Beaudette</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"curl"</span><span class="op">)</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>   <span class="fu">curl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/curl/man/nslookup.html" class="external-link">has_internet</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span>    <span class="co"># get spatial data for a single mukey</span></span></span>
<span class="r-in"><span>    <span class="va">single.mukey</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">fetchSDA_spatial</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"2924882"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># demonstrate fetching full extent (multi-mukey) of national musym</span></span></span>
<span class="r-in"><span>    <span class="va">full.extent.nmusym</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">fetchSDA_spatial</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"2x8l5"</span>, by <span class="op">=</span> <span class="st">"nmusym"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># compare extent of nmusym to single mukey within it</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">single.mukey</span>, <span class="st">'try-error'</span><span class="op">)</span> <span class="op">&amp;&amp;</span> </span></span>
<span class="r-in"><span>        <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">full.extent.nmusym</span>, <span class="st">'try-error'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        </span></span>
<span class="r-in"><span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"sf"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      </span></span>
<span class="r-in"><span>         <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">full.extent.nmusym</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"RED"</span>, border <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>         <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">single.mukey</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"BLUE"</span>, border <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>       </span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>        </span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># demo adding a field (`muname`) to attribute table of result</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">fetchSDA_spatial</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"2x8l5"</span>, by<span class="op">=</span><span class="st">"nmusym"</span>, add.fields<span class="op">=</span><span class="st">"muname"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 1 chunks...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Chunk #1 completed (n = 1; 0.1 secs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Done in 0.1 secs; mean/chunk: 0.1 secs; mean/symbol: 0.15 secs.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 1 chunks...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Chunk #1 completed (n = 3; 0.8 secs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Done in 1 secs; mean/chunk: 0.8 secs; mean/symbol: 0.34 secs.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 1 chunks...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Chunk #1 completed (n = 3; 0.6 secs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Done in 0.8 secs; mean/chunk: 0.6 secs; mean/symbol: 0.25 secs.</span>
<span class="r-plt img"><img src="fetchSDA_spatial-1.png" alt="" width="768" height="475"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 6 features and 4 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: POLYGON</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: -121.034 ymin: 38.01706 xmax: -120.9596 ymax: 38.24938</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geodetic CRS:  WGS 84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    mukey areasymbol nationalmusym                                        muname</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 462101      CA077         2x8l5 Pentz-Bellota complex, 2 to 15 percent slopes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                             geom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 POLYGON ((-121.0226 38.2276...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 POLYGON ((-121.0141 38.2325...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 POLYGON ((-121.0339 38.2325...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 POLYGON ((-120.9955 38.0674...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 POLYGON ((-121.0102 38.1891...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 POLYGON ((-120.9648 38.0208...</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker, Andrew Brown.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

