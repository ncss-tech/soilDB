<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Local SSURGO Databases • soilDB</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Local SSURGO Databases">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">soilDB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.8.12</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/dominant-es.html">Mapping Dominant Ecological Sites using SSURGO Data</a></li>
    <li><a class="dropdown-item" href="../articles/fetchNASIS.html">fetchNASIS(from='pedons') Columns</a></li>
    <li><a class="dropdown-item" href="../articles/local-ssurgo.html">Local SSURGO Databases</a></li>
    <li><a class="dropdown-item" href="../articles/wcs-ssurgo.html">Map Unit Key Grids and Thematic Maps of Soil Survey Geographic (SSURGO) Data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncss-tech/soilDB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Local SSURGO Databases</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/soilDB/blob/2.8.12/vignettes/local-ssurgo.Rmd" class="external-link"><code>vignettes/local-ssurgo.Rmd</code></a></small>
      <div class="d-none name"><code>local-ssurgo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>soilDB</code> package provides tools for accessing and
working with soil survey data from the USDA-NRCS. Two key functions,
<code><a href="../reference/downloadSSURGO.html">downloadSSURGO()</a></code> and <code><a href="../reference/createSSURGO.html">createSSURGO()</a></code>,
streamline the process of acquiring and preparing SSURGO data into a
local SQLite (GeoPackage) database–similar to the functionality offered
by <a href="https://nrcs.usda.gov/resources/data-and-reports/ssurgo-portal" class="external-link">SSURGO
Portal</a>.</p>
<p>This vignette demonstrates how to use these functions with Morton and
Stanton counties, Kansas
(<code>areasymbol = c("KS129", "KS187")</code>).</p>
</div>
<div class="section level2">
<h2 id="download-ssurgo-data">Download SSURGO Data<a class="anchor" aria-label="anchor" href="#download-ssurgo-data"></a>
</h2>
<p><code><a href="../reference/downloadSSURGO.html">downloadSSURGO()</a></code> will download the official SSURGO
dataset for the specified <code>areasymbol</code> and return the path to
the ZIP archive.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncss-tech/soilDB/" class="external-link">soilDB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">gpkg_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">AREASYMBOLS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"KS129"</span>, <span class="st">"KS187"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ssurgo_zip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/downloadSSURGO.html">downloadSSURGO</a></span><span class="op">(</span></span>
<span>  areasymbol <span class="op">=</span> <span class="va">AREASYMBOLS</span>, </span>
<span>  destdir <span class="op">=</span> <span class="va">gpkg_dir</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We specify <code>destdir</code> as the destination directory to
download ZIP files by areasymbol from Web Soil Survey. If unspecified
<code>exdir</code> is the same as <code>destdir</code> and is the
directory the ZIP files get extracted to.</p>
</div>
<div class="section level2">
<h2 id="create-a-local-ssurgo-database">Create a Local SSURGO Database<a class="anchor" aria-label="anchor" href="#create-a-local-ssurgo-database"></a>
</h2>
<p>The <code><a href="../reference/createSSURGO.html">createSSURGO()</a></code> function uses the <code>sf</code> and
<code>RSQLite</code> packages internally to build a SQLite database. The
suggested SQLite-based format to use is GeoPackage (<code>".gpkg"</code>
file).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a local GeoPackage from the downloaded ZIP</span></span>
<span><span class="va">gpkg_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">gpkg_dir</span>, <span class="st">"ssurgo.gpkg"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/createSSURGO.html">createSSURGO</a></span><span class="op">(</span></span>
<span>  <span class="va">gpkg_path</span>,</span>
<span>  exdir <span class="op">=</span> <span class="va">gpkg_dir</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here we pass <code>exdir</code> so <code><a href="../reference/createSSURGO.html">createSSURGO()</a></code> knows
where to look for the data that <code><a href="../reference/downloadSSURGO.html">downloadSSURGO()</a></code> extracted
from ZIP files. If we supply <code>con</code> argument instaed of
<code>filename</code> we can connect to arbitrary DBIConnection objects,
which could include other SQLite connection types, DuckDB,
PostgresSQL.</p>
<p>The resulting <code>.gpkg</code> file is a spatially enabled SQLite
database that can be used in GIS software or queried directly in R.</p>
</div>
<div class="section level2">
<h2 id="load-and-explore-the-database">Load and Explore the Database<a class="anchor" aria-label="anchor" href="#load-and-explore-the-database"></a>
</h2>
<p>Once the GeoPackage is created, you can connect to it using
<code>DBI</code> and explore its contents. The database follows the
SSURGO schema, which includes tables like <code>mapunit</code>,
<code>component</code>, <code>chorizon</code>, and spatial layers such
as the spatial map unit polygon layer, <code>mupolygon</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Connect to the GeoPackage</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">gpkg_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># List available tables</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListTables.html" class="external-link">dbListTables</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "chaashto"                    "chconsistence"              </span></span>
<span><span class="co">##  [3] "chdesgnsuffix"               "chfrags"                    </span></span>
<span><span class="co">##  [5] "chorizon"                    "chpores"                    </span></span>
<span><span class="co">##  [7] "chstruct"                    "chstructgrp"                </span></span>
<span><span class="co">##  [9] "chtexture"                   "chtexturegrp"               </span></span>
<span><span class="co">## [11] "chtexturemod"                "chunified"                  </span></span>
<span><span class="co">## [13] "cocropyld"                   "codiagfeatures"             </span></span>
<span><span class="co">## [15] "coecoclass"                  "coeplants"                  </span></span>
<span><span class="co">## [17] "coerosionacc"                "cogeomordesc"               </span></span>
<span><span class="co">## [19] "cohydriccriteria"            "cointerp"                   </span></span>
<span><span class="co">## [21] "comonth"                     "component"                  </span></span>
<span><span class="co">## [23] "copm"                        "copmgrp"                    </span></span>
<span><span class="co">## [25] "copwindbreak"                "corestrictions"             </span></span>
<span><span class="co">## [27] "cosoilmoist"                 "cosurffrags"                </span></span>
<span><span class="co">## [29] "cosurfmorphgc"               "cosurfmorphhpp"             </span></span>
<span><span class="co">## [31] "cosurfmorphmr"               "cosurfmorphss"              </span></span>
<span><span class="co">## [33] "cotaxfmmin"                  "cotaxmoistcl"               </span></span>
<span><span class="co">## [35] "cotext"                      "cotreestomng"               </span></span>
<span><span class="co">## [37] "cotxfmother"                 "distinterpmd"               </span></span>
<span><span class="co">## [39] "distlegendmd"                "distmd"                     </span></span>
<span><span class="co">## [41] "featdesc"                    "featline"                   </span></span>
<span><span class="co">## [43] "featpoint"                   "gpkg_contents"              </span></span>
<span><span class="co">## [45] "gpkg_extensions"             "gpkg_geometry_columns"      </span></span>
<span><span class="co">## [47] "gpkg_ogr_contents"           "gpkg_spatial_ref_sys"       </span></span>
<span><span class="co">## [49] "gpkg_tile_matrix"            "gpkg_tile_matrix_set"       </span></span>
<span><span class="co">## [51] "laoverlap"                   "legend"                     </span></span>
<span><span class="co">## [53] "mapunit"                     "mdstatdomdet"               </span></span>
<span><span class="co">## [55] "mdstatdommas"                "mdstatidxdet"               </span></span>
<span><span class="co">## [57] "mdstatidxmas"                "mdstatrshipdet"             </span></span>
<span><span class="co">## [59] "mdstatrshipmas"              "mdstattabcols"              </span></span>
<span><span class="co">## [61] "mdstattabs"                  "muaggatt"                   </span></span>
<span><span class="co">## [63] "muaoverlap"                  "muline"                     </span></span>
<span><span class="co">## [65] "mupoint"                     "mupolygon"                  </span></span>
<span><span class="co">## [67] "rtree_featline_geom"         "rtree_featline_geom_node"   </span></span>
<span><span class="co">## [69] "rtree_featline_geom_parent"  "rtree_featline_geom_rowid"  </span></span>
<span><span class="co">## [71] "rtree_featpoint_geom"        "rtree_featpoint_geom_node"  </span></span>
<span><span class="co">## [73] "rtree_featpoint_geom_parent" "rtree_featpoint_geom_rowid" </span></span>
<span><span class="co">## [75] "rtree_muline_geom"           "rtree_muline_geom_node"     </span></span>
<span><span class="co">## [77] "rtree_muline_geom_parent"    "rtree_muline_geom_rowid"    </span></span>
<span><span class="co">## [79] "rtree_mupoint_geom"          "rtree_mupoint_geom_node"    </span></span>
<span><span class="co">## [81] "rtree_mupoint_geom_parent"   "rtree_mupoint_geom_rowid"   </span></span>
<span><span class="co">## [83] "rtree_mupolygon_geom"        "rtree_mupolygon_geom_node"  </span></span>
<span><span class="co">## [85] "rtree_mupolygon_geom_parent" "rtree_mupolygon_geom_rowid" </span></span>
<span><span class="co">## [87] "rtree_sapolygon_geom"        "rtree_sapolygon_geom_node"  </span></span>
<span><span class="co">## [89] "rtree_sapolygon_geom_parent" "rtree_sapolygon_geom_rowid" </span></span>
<span><span class="co">## [91] "sacatalog"                   "sainterp"                   </span></span>
<span><span class="co">## [93] "sapolygon"                   "sdvalgorithm"               </span></span>
<span><span class="co">## [95] "sdvattribute"                "sdvfolder"                  </span></span>
<span><span class="co">## [97] "sdvfolderattribute"          "soil_metadata"              </span></span>
<span><span class="co">## [99] "sqlite_sequence"</span></span></code></pre>
<div class="section level3">
<h3 id="view-table-structure">View Table Structure<a class="anchor" aria-label="anchor" href="#view-table-structure"></a>
</h3>
<p>You can inspect the structure of a specific table, such as
<code>mapunit</code>, which contains general information about each map
unit.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListFields.html" class="external-link">dbListFields</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"mapunit"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "musym"         "muname"        "mukind"        "mustatus"     </span></span>
<span><span class="co">##  [5] "muacres"       "mapunitlfw_l"  "mapunitlfw_r"  "mapunitlfw_h" </span></span>
<span><span class="co">##  [9] "mapunitpfa_l"  "mapunitpfa_r"  "mapunitpfa_h"  "farmlndcl"    </span></span>
<span><span class="co">## [13] "muhelcl"       "muwathelcl"    "muwndhelcl"    "interpfocus"  </span></span>
<span><span class="co">## [17] "invesintens"   "iacornsr"      "nhiforsoigrp"  "nhspiagr"     </span></span>
<span><span class="co">## [21] "vtsepticsyscl" "mucertstat"    "lkey"          "mukey"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="preview-data">Preview Data<a class="anchor" aria-label="anchor" href="#preview-data"></a>
</h3>
<p>Preview the first few rows of the <code>mapunit</code> table:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM mapunit LIMIT 5"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   musym                                                muname       mukind</span></span>
<span><span class="co">## 1  1510             Atchison clay loam, 3 to 6 percent slopes Consociation</span></span>
<span><span class="co">## 2  5110       Atchison fine sandy loam, 1 to 3 percent slopes Consociation</span></span>
<span><span class="co">## 3  1511                  Atchison loam, 1 to 3 percent slopes Consociation</span></span>
<span><span class="co">## 4  1512                  Atchison loam, 6 to 9 percent slopes Consociation</span></span>
<span><span class="co">## 5  1515 Atchison-Rock outcrop complex, 6 to 20 percent slopes      Complex</span></span>
<span><span class="co">##   mustatus muacres mapunitlfw_l mapunitlfw_r mapunitlfw_h mapunitpfa_l</span></span>
<span><span class="co">## 1       NA   15733           NA           NA           NA           NA</span></span>
<span><span class="co">## 2       NA      62           NA           NA           NA           NA</span></span>
<span><span class="co">## 3       NA   36516           NA           NA           NA           NA</span></span>
<span><span class="co">## 4       NA    4666           NA           NA           NA           NA</span></span>
<span><span class="co">## 5       NA    3488           NA           NA           NA           NA</span></span>
<span><span class="co">##   mapunitpfa_r mapunitpfa_h                        farmlndcl muhelcl muwathelcl</span></span>
<span><span class="co">## 1           NA           NA Farmland of statewide importance      NA         NA</span></span>
<span><span class="co">## 2           NA           NA      Prime farmland if irrigated      NA         NA</span></span>
<span><span class="co">## 3           NA           NA      Prime farmland if irrigated      NA         NA</span></span>
<span><span class="co">## 4           NA           NA Farmland of statewide importance      NA         NA</span></span>
<span><span class="co">## 5           NA           NA Farmland of statewide importance      NA         NA</span></span>
<span><span class="co">##   muwndhelcl interpfocus invesintens iacornsr nhiforsoigrp nhspiagr</span></span>
<span><span class="co">## 1         NA                 Order 2       NA           NA       NA</span></span>
<span><span class="co">## 2         NA                 Order 2       NA           NA       NA</span></span>
<span><span class="co">## 3         NA                 Order 2       NA           NA       NA</span></span>
<span><span class="co">## 4         NA                 Order 2       NA           NA       NA</span></span>
<span><span class="co">## 5         NA                 Order 2       NA           NA       NA</span></span>
<span><span class="co">##   vtsepticsyscl mucertstat  lkey   mukey</span></span>
<span><span class="co">## 1            NA         NA 10591 1382580</span></span>
<span><span class="co">## 2            NA         NA 10591 1382581</span></span>
<span><span class="co">## 3            NA         NA 10591 1382582</span></span>
<span><span class="co">## 4            NA         NA 10591 1382583</span></span>
<span><span class="co">## 5            NA         NA 10591 1382584</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="join-tables">Join Tables<a class="anchor" aria-label="anchor" href="#join-tables"></a>
</h3>
<p>You can join tables to explore relationships between map units and
their components:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">SELECT mu.musym, mu.muname, c.compname, c.comppct_r</span></span>
<span><span class="st">FROM mapunit mu</span></span>
<span><span class="st">JOIN component c ON mu.mukey = c.mukey</span></span>
<span><span class="st">LIMIT 10</span></span>
<span><span class="st">"</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">query</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    musym                                          muname compname comppct_r</span></span>
<span><span class="co">## 1   1510       Atchison clay loam, 3 to 6 percent slopes Atchison        90</span></span>
<span><span class="co">## 2   1510       Atchison clay loam, 3 to 6 percent slopes    Otero        10</span></span>
<span><span class="co">## 3   5110 Atchison fine sandy loam, 1 to 3 percent slopes   Bigbow         5</span></span>
<span><span class="co">## 4   5110 Atchison fine sandy loam, 1 to 3 percent slopes Atchison        70</span></span>
<span><span class="co">## 5   5110 Atchison fine sandy loam, 1 to 3 percent slopes    Otero        25</span></span>
<span><span class="co">## 6   1511            Atchison loam, 1 to 3 percent slopes  Satanta         5</span></span>
<span><span class="co">## 7   1511            Atchison loam, 1 to 3 percent slopes Atchison        85</span></span>
<span><span class="co">## 8   1511            Atchison loam, 1 to 3 percent slopes    Otero        10</span></span>
<span><span class="co">## 9   1512            Atchison loam, 6 to 9 percent slopes Atchison        80</span></span>
<span><span class="co">## 10  1512            Atchison loam, 6 to 9 percent slopes    Otero        20</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="load-spatial-data">Load Spatial Data<a class="anchor" aria-label="anchor" href="#load-spatial-data"></a>
</h3>
<p>To work with spatial features, use the <code>sf</code> package.</p>
<p>Here we demonstrate how to read the <code>mupolygon</code> layer:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read spatial map units</span></span>
<span><span class="va">spatial_mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">gpkg_path</span>, layer <span class="op">=</span> <span class="st">"mupolygon"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `mupolygon' from data source `/tmp/RtmpHhWLeb/ssurgo.gpkg' using driver `GPKG'</span></span>
<span><span class="co">## Simple feature collection with 3333 features and 4 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -102.0421 ymin: 36.99309 xmax: -101.5257 ymax: 37.7385</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spatial_mu</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 3333 features and 4 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -102.0421 ymin: 36.99309 xmax: -101.5257 ymax: 37.7385</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## First 10 features:</span></span>
<span><span class="co">##    areasymbol spatialver musym   mukey                           geom</span></span>
<span><span class="co">## 1       KS129          5  1996 1382616 POLYGON ((-101.972 37.26513...</span></span>
<span><span class="co">## 2       KS129          5  1511 1382582 POLYGON ((-101.7587 37.2546...</span></span>
<span><span class="co">## 3       KS129          5  1462 1382612 POLYGON ((-101.708 37.27559...</span></span>
<span><span class="co">## 4       KS129          5  1996 1382616 POLYGON ((-101.8841 37.3115...</span></span>
<span><span class="co">## 5       KS129          5  1995 1382615 POLYGON ((-101.8418 37.3153...</span></span>
<span><span class="co">## 6       KS129          5  1511 1382582 POLYGON ((-102.0278 37.2308...</span></span>
<span><span class="co">## 7       KS129          5  1512 1382583 POLYGON ((-101.9374 37.1191...</span></span>
<span><span class="co">## 8       KS129          5  1510 1382580 POLYGON ((-101.6442 37.2200...</span></span>
<span><span class="co">## 9       KS129          5  1995 1382615 POLYGON ((-101.5774 37.3227...</span></span>
<span><span class="co">## 10      KS129          5  1761 1382608 POLYGON ((-102.0419 37.2821...</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the map units</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">spatial_mu</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="local-ssurgo_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>This spatial layer can be used for mapping or spatial joins with
other geospatial datasets. The <code>mukey</code> column is the unique
mapunit identifier. Any SSURGO data that can be queried or aggregated to
be 1:1 with <code>mukey</code> can be used in thematic mapping.</p>
</div>
</div>
<div class="section level2">
<h2 id="visualizing-soil-properties">Visualizing Soil Properties<a class="anchor" aria-label="anchor" href="#visualizing-soil-properties"></a>
</h2>
<p>You can visualize soil properties by joining tabular data with the
<code>mupolygon</code> layer and plotting with base R graphics.</p>
<div class="section level3">
<h3 id="load-spatial-and-tabular-data">Load Spatial and Tabular Data<a class="anchor" aria-label="anchor" href="#load-spatial-and-tabular-data"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read spatial map units</span></span>
<span><span class="va">spatial_mu</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">gpkg_path</span>, layer <span class="op">=</span> <span class="st">"mupolygon"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `mupolygon' from data source `/tmp/RtmpHhWLeb/ssurgo.gpkg' using driver `GPKG'</span></span>
<span><span class="co">## Simple feature collection with 3333 features and 4 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -102.0421 ymin: 36.99309 xmax: -101.5257 ymax: 37.7385</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read tabular data</span></span>
<span><span class="va">mapunit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbReadTable.html" class="external-link">dbReadTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"mapunit"</span><span class="op">)</span></span>
<span><span class="va">component</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbReadTable.html" class="external-link">dbReadTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"component"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Disconnect when done</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-1-dominant-component-percentage-comppct_r">Example 1: Dominant Component Percentage
(<code>comppct_r</code>)<a class="anchor" aria-label="anchor" href="#example-1-dominant-component-percentage-comppct_r"></a>
</h3>
<p>Here we see map units symbolised by the dominant component
percentage. Numbers closer to 100% are more “pure” concepts.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get dominant component per map unit</span></span>
<span><span class="va">dominant_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">comppct_r</span> <span class="op">~</span> <span class="va">mukey</span>,</span>
<span>  data <span class="op">=</span> <span class="va">component</span>, </span>
<span>  <span class="va">max</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join with spatial data</span></span>
<span><span class="va">spatial_mu</span><span class="op">$</span><span class="va">comppct_r</span> <span class="op">&lt;-</span> <span class="va">dominant_comp</span><span class="op">$</span><span class="va">comppct_r</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">spatial_mu</span><span class="op">$</span><span class="va">mukey</span>, <span class="va">dominant_comp</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot (small subset of extent)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">spatial_mu</span><span class="op">[</span><span class="st">"comppct_r"</span><span class="op">]</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"Dominant Component Percentage (comppct_r)"</span>, </span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>  key.pos <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  border <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>  pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="local-ssurgo_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="example-2-hydrologic-group-hydgrp">Example 2: Hydrologic Group (<code>hydgrp</code>)<a class="anchor" aria-label="anchor" href="#example-2-hydrologic-group-hydgrp"></a>
</h3>
<p>Here we see map unit dominant condition <a href="https://directives.nrcs.usda.gov/sites/default/files2/1712930597/11905.pdf" class="external-link">Hydrologic
Group</a>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get most common hydgrp per mukey</span></span>
<span><span class="va">hydgrp_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">hydgrp</span> <span class="op">~</span> <span class="va">mukey</span>, </span>
<span>  data <span class="op">=</span> <span class="va">component</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to ordered factor</span></span>
<span><span class="va">hydgrp_tab</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NASISChoiceList.html">NASISChoiceList</a></span><span class="op">(</span><span class="va">hydgrp_tab</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Join with spatial data</span></span>
<span><span class="va">spatial_mu</span><span class="op">$</span><span class="va">hydgrp</span> <span class="op">&lt;-</span> <span class="va">hydgrp_tab</span><span class="op">$</span><span class="va">hydgrp</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">spatial_mu</span><span class="op">$</span><span class="va">mukey</span>, <span class="va">hydgrp_tab</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">spatial_mu</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 3333 features and 6 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -102.0421 ymin: 36.99309 xmax: -101.5257 ymax: 37.7385</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## First 10 features:</span></span>
<span><span class="co">##    areasymbol spatialver musym   mukey                           geom comppct_r</span></span>
<span><span class="co">## 1       KS129          5  1996 1382616 POLYGON ((-101.972 37.26513...        80</span></span>
<span><span class="co">## 2       KS129          5  1511 1382582 POLYGON ((-101.7587 37.2546...        85</span></span>
<span><span class="co">## 3       KS129          5  1462 1382612 POLYGON ((-101.708 37.27559...        70</span></span>
<span><span class="co">## 4       KS129          5  1996 1382616 POLYGON ((-101.8841 37.3115...        80</span></span>
<span><span class="co">## 5       KS129          5  1995 1382615 POLYGON ((-101.8418 37.3153...        75</span></span>
<span><span class="co">## 6       KS129          5  1511 1382582 POLYGON ((-102.0278 37.2308...        85</span></span>
<span><span class="co">## 7       KS129          5  1512 1382583 POLYGON ((-101.9374 37.1191...        80</span></span>
<span><span class="co">## 8       KS129          5  1510 1382580 POLYGON ((-101.6442 37.2200...        90</span></span>
<span><span class="co">## 9       KS129          5  1995 1382615 POLYGON ((-101.5774 37.3227...        75</span></span>
<span><span class="co">## 10      KS129          5  1761 1382608 POLYGON ((-102.0419 37.2821...        93</span></span>
<span><span class="co">##    hydgrp</span></span>
<span><span class="co">## 1       b</span></span>
<span><span class="co">## 2       b</span></span>
<span><span class="co">## 3       b</span></span>
<span><span class="co">## 4       b</span></span>
<span><span class="co">## 5       b</span></span>
<span><span class="co">## 6       b</span></span>
<span><span class="co">## 7       a</span></span>
<span><span class="co">## 8       a</span></span>
<span><span class="co">## 9       b</span></span>
<span><span class="co">## 10      c</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">spatial_mu</span><span class="op">[</span><span class="st">"hydgrp"</span><span class="op">]</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Hydrologic Group (hydgrp)"</span>, </span>
<span>  key.pos <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  border <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>  pal <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/flip.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="local-ssurgo_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="example-3-drainage-class-drainagecl">Example 3: Drainage Class (<code>drainagecl</code>)<a class="anchor" aria-label="anchor" href="#example-3-drainage-class-drainagecl"></a>
</h3>
<p>Here we see map unit dominant condition Drainage Class.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get most common drainage class per mukey</span></span>
<span><span class="va">drainage_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">drainagecl</span> <span class="op">~</span> <span class="va">mukey</span>, </span>
<span>  data <span class="op">=</span> <span class="va">component</span>, </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to ordered factor</span></span>
<span><span class="va">drainage_tab</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NASISChoiceList.html">NASISChoiceList</a></span><span class="op">(</span><span class="va">drainage_tab</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Join with spatial data</span></span>
<span><span class="va">spatial_mu</span><span class="op">$</span><span class="va">drainagecl</span> <span class="op">&lt;-</span> <span class="va">drainage_tab</span><span class="op">$</span><span class="va">drainagecl</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">spatial_mu</span><span class="op">$</span><span class="va">mukey</span>, <span class="va">drainage_tab</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">spatial_mu</span><span class="op">[</span><span class="st">"drainagecl"</span><span class="op">]</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Drainage Class (drainagecl)"</span>, </span>
<span>  border <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  key.pos <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  pal <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/flip.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="local-ssurgo_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<hr>
<p>The previous examples show how to visualize key soil properties using
only base R and <code>sf</code>.</p>
<p>The aggregation of dominant component to map unit level values is one
of the simplest, and most common, transformations of the SSURGO data for
creating maps.</p>
<p>You can adapt the aggregation logic depending on your needs (e.g.,
max, mean, or most frequent value). Many soilDB functions include
default aggregations, and you can write custom queries of your own using
<code><a href="../reference/SDA_query.html">SDA_query()</a></code> or DBI <code><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="query-and-aggregation-functions">Query and Aggregation Functions<a class="anchor" aria-label="anchor" href="#query-and-aggregation-functions"></a>
</h2>
<p>This section describes some existing options in the
<code>soilDB</code> package for querying and aggregating data for
thematic maps.</p>
<p>In the future this section will be expanded.</p>
<p>All of the <code>get_SDA_*()</code> “SSURGO On Demand” functions can
be applied to local copies of the SSURGO database by passing the
<code>dsn</code> argument (either a path to a SQLite database or a
<em>DBIConnection</em> object).</p>
<ul>
<li>“SSURGO On Demand” Queries
<ul>
<li>Hydric Soils: <a href="http://ncss-tech.github.io/soilDB/reference/get_SDA_hydric.html"><code>get_SDA_hydric()</code></a>
</li>
<li>Soil Interpretations: <a href="http://ncss-tech.github.io/soilDB/reference/get_SDA_interpretation.html"><code>get_SDA_interpretation()</code></a>
</li>
<li>Mapunit Aggregate Attributes : <a href="http://ncss-tech.github.io/soilDB/reference/get_SDA_muaggatt.html"><code>get_SDA_muaggatt()</code></a>
</li>
<li>Parent Material Groups: <a href="http://ncss-tech.github.io/soilDB/reference/get_SDA_pmgroupname.html"><code>get_SDA_pmgroupname()</code></a>
</li>
<li>Component and Horizon Properties: <a href="http://ncss-tech.github.io/soilDB/reference/get_SDA_property.html"><code>get_SDA_property()</code></a>
</li>
<li>Component Ecological Classes: <a href="http://ncss-tech.github.io/soilDB/reference/get_SDA_coecoclass.html"><code>get_SDA_coecoclass()</code></a>
</li>
<li>Component Surface Morphometry: <a href="http://ncss-tech.github.io/soilDB/reference/get_SDA_cosurfmorph.html"><code>get_SDA_cosurfmorph()</code></a>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="alternative-tools">Alternative Tools<a class="anchor" aria-label="anchor" href="#alternative-tools"></a>
</h2>
<p>For users who prefer a Python-based solution, the <a href="https://github.com/brownag/SSURGOPortalR" class="external-link">SSURGOPortal R
package</a> wraps the official <a href="https://www.nrcs.usda.gov/resources/data-and-reports/ssurgo-portal" class="external-link">SSURGO
Portal Python</a> code for use in R.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code><a href="../reference/downloadSSURGO.html">downloadSSURGO()</a></code> and <code><a href="../reference/createSSURGO.html">createSSURGO()</a></code>
functions provide a reproducible and scriptable way to access SSURGO
data for offline spatial and tabular analysis in R.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker, Andrew Brown.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
