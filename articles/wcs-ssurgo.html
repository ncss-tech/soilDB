<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="soilDB">
<title>Map Unit Key Grids and Thematic Maps of Soil Survey Geographic (SSURGO) Data • soilDB</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Map Unit Key Grids and Thematic Maps of Soil Survey Geographic (SSURGO) Data">
<meta property="og:description" content="soilDB">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">soilDB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.8.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/fetchNASIS.html">fetchNASIS(from='pedons') Columns</a>
    <a class="dropdown-item" href="../articles/wcs-ssurgo.html">Map Unit Key Grids and Thematic Maps of Soil Survey Geographic (SSURGO) Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ncss-tech/soilDB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Map Unit Key Grids and Thematic Maps of Soil Survey Geographic (SSURGO) Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/soilDB/blob/HEAD/vignettes/wcs-ssurgo.Rmd" class="external-link"><code>vignettes/wcs-ssurgo.Rmd</code></a></small>
      <div class="d-none name"><code>wcs-ssurgo.Rmd</code></div>
    </div>

    
    
<p>This vignette will explore how to use the soilDB package to create
thematic maps of the Soil Survey Geographic Database (SSURGO) via Soil
Data Access (SDA) and SoilWeb coverage services.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A web coverage service (WCS) is provided for the gSSURGO and gNATGSO
<a href="https://nrcs.app.box.com/v/soils/folder/180456387335" class="external-link">map unit
key grids</a> by the <a href="https://casoilresource.lawr.ucdavis.edu/" class="external-link">UCDavis California Soil
Resource Lab</a> SoilWeb server. These grids are a raster representation
of the gSSURGO and gNATSGO map unit keys (<code>mukey</code>) for the
conterminous United States at a resolution of 30m. The GeoTIFF format is
used to ensure maximum compatibility. Cell values are map unit keys,
encoded as unsigned 32-bit integers. The standard spatial reference for
the grids is Albers Equal Area Conic (NAD83) coordinate reference system
(<code>"EPSG:5070"</code>). The grids are ‘LZW’ compressed and
internally tiled for efficient random access. The grid topology and cell
values are identical to the rasters contained within the gSSURGO and
gNATSGO File Geodatabases (FGDB).</p>
<p>The files backing each WCS are re-created annually after the SSURGO
annual refresh on October 1st. They are typically in-sync with the
official version of the data hosted by Soil Data Access by early
November. Map unit keys can change over time, especially in soil survey
areas that were updated during the last fiscal year.</p>
<p>In addition to the standard CONUS gSSURGO and gNATSGO grids, these
web coverage services are also provided:</p>
<ul>
<li><p>Raster Soil Survey (RSS) products at 10m resolution
(EPSG:5070).</p></li>
<li><p>STATSGO2 (2016) at 300m resolution (EPSG:5070).</p></li>
<li><p>SSURGO in HI (EPSG:6628) and PR (EPSG:32161) at 30m
resolution.</p></li>
<li><p><a href="https://casoilresource.lawr.ucdavis.edu/soil-properties/" class="external-link">ISSR-800
soil property grids</a>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Get the latest CRAN version of <code>soilDB</code>,
<code>terra</code> and <code>sf</code> for the following examples.
<code>terra</code> is required for handling of raster data.
<code>sf</code> or <code>terra</code> may be used for handling vector
data for as inputs to web coverage service functions, and examples
demonstrate usage of both packages for this purpose. In general for
<code>soilDB</code> functions that take spatial inputs, if
<code>terra</code> objects are used as input, <code>terra</code> objects
are returned.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'soilDB'</span>, <span class="st">'terra'</span>, <span class="st">'sf'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Consider also installing the latest development versions from GitHub
or <a href="https://r-universe.dev/" class="external-link">r-universe</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'soilDB'</span>, <span class="st">'terra'</span>, <span class="st">'sf'</span><span class="op">)</span>,</span>
<span>  repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'https://ncss-tech.r-universe.dev'</span>,</span>
<span>            <span class="st">'https://rspatial.r-universe.dev'</span>,</span>
<span>            <span class="st">'https://r-spatial.r-universe.dev'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="grid-selection">Grid Selection<a class="anchor" aria-label="anchor" href="#grid-selection"></a>
</h3>
<p>Here are some basic usage examples for the coverage services that can
be accessed with <code><a href="../reference/mukey.wcs.html">mukey.wcs()</a></code>.</p>
<p>See the <a href="http://ncss-tech.github.io/soilDB/reference/mukey.wcs.html"><code>mukey.wcs</code></a>
manual pages for details.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select gSSURGO grid, 30m resolution</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, db <span class="op">=</span> <span class="st">'gssurgo'</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># select gNATSGO grid, 30m resolution</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, db <span class="op">=</span> <span class="st">'gnatsgo'</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># select RSS grid, 10m resolution</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, db <span class="op">=</span> <span class="st">'RSS'</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># select STATSGO2 grid, 300m resolution</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, db <span class="op">=</span> <span class="st">'statsgo'</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p><a href="http://ncss-tech.github.io/soilDB/reference/ISSR800.wcs.html"><code>ISSR800.wcs</code></a>
is a similar function that makes available a variety of pre-aggregated
800m resolution properties derived from gNATSGO.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select various ISSR-800 grids, details below</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ISSR800.wcs.html">ISSR800.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">aoi</span>, var <span class="op">=</span> <span class="st">'paws'</span><span class="op">)</span></span></code></pre></div>
<p>This is where we will link to a more detailed ISSR800 vignette in the
future.</p>
<div class="section level4">
<h4 id="gssurgo">gSSURGO<a class="anchor" aria-label="anchor" href="#gssurgo"></a>
</h4>
<p>Excerpt from the <a href="https://www.nrcs.usda.gov/resources/data-and-reports/gridded-soil-survey-geographic-gssurgo-database#release" class="external-link">gSSURGO
documentation</a>.</p>
<div style="padding: 10px; font-size:90%;">
<p>The gSSURGO Database is derived from the official Soil Survey
Geographic (SSURGO) Database. SSURGO generally has the most detailed
level of soil geographic data developed by the National Cooperative Soil
Survey (NCSS) in accordance with NCSS mapping standards. The tabular
data represent the soil attributes and are derived from properties and
characteristics stored in the National Soil Information System (NASIS).
The gSSURGO data were prepared by merging the traditional vector-based
SSURGO digital map data and tabular data into statewide extents, adding
a statewide gridded map layer derived from the vector layer, and adding
a new value-added look up table (Valu1) containing “ready to map”
attributes. The gridded map layer is a file geodatabase raster in an
ArcGIS file geodatabase. The raster and vector map data have a statewide
extent. The raster map data have a 10-meter cell size that approximates
the vector polygons in an Albers Equal Area projection. Each cell (and
polygon) is linked to a map unit identifier called the map unit key. A
unique map unit key is used to link the raster cells and polygons to
attribute tables. Due to file size, the raster layer for the
conterminous United States is only available in a 30-meter
resolution.</p>
</div>
</div>
<div class="section level4">
<h4 id="gnatsgo">gNATSGO<a class="anchor" aria-label="anchor" href="#gnatsgo"></a>
</h4>
<p>Excerpt from the <a href="https://www.nrcs.usda.gov/resources/data-and-reports/gridded-national-soil-survey-geographic-database-gnatsgo" class="external-link">gNATSGO
documentation</a>.</p>
<div style="padding: 10px; font-size:90%;">
<p>The gNATSGO databases contain a raster of the soil map units and 70
related tables of soil properties and interpretations. They are designed
to work with the SPSD gSSURGO ArcTools. Users can create full coverage
thematic maps and grids of soil properties and interpretations for large
geographic areas, such as the extent of a State or the conterminous
United States. Please note that the State-wide geodatabases contain a 10
meter raster and the CONUS database contains a 30 meter raster.</p>
<p>The gNATSGO database is composed primarily of SSURGO data, but
STATSGO2 data was used to fill in the gaps. The RSSs are newer product
with relatively limited spatial extent. These RSSs were merged into the
gNATSGO after combining the SSURGO and STATSGO2 data. The extent of RSS
is expected to increase in the coming years.</p>
</div>
</div>
<div class="section level4">
<h4 id="raster-soil-survey">Raster Soil Survey<a class="anchor" aria-label="anchor" href="#raster-soil-survey"></a>
</h4>
<p>Excerpt from the <a href="https://www.nrcs.usda.gov/resources/data-and-reports/raster-soil-surveys-rss" class="external-link">RSS
documentation</a>.</p>
<div style="padding: 10px; font-size:90%;">
<p>Raster Soil Survey is a reference to the products of soil survey work
completed using digital soil mapping methodologies. Digital soil mapping
is the production of georeferenced soil databases based on the
quantitative relationships between soil measurements made in the field
or laboratory and environmental data and may be represented as either
discrete classes or continuous soil properties. Both digital and
traditional soil mapping use a conceptual soil-landscape model as a
means for organizing environmental information into discrete divisions.
The primary difference between these two approaches is that digital
methods exploit quantitative relationships of the environmental
information, while traditional methods utilize a more subjective
approach and the approximate relationships of the environmental
information to spatially represent where the divisions are
represented.</p>
</div>
<p>An experimental, 300m gridded representation of STATSGO 2 is provided
by the SoilWeb web coverage service. This is not an official USDA-NRCS
product.</p>
</div>
<div class="section level4">
<h4 id="statsgo">STATSGO<a class="anchor" aria-label="anchor" href="#statsgo"></a>
</h4>
<p>Excerpt from <a href="https://www.nrcs.usda.gov/resources/data-and-reports/description-of-statsgo2-database" class="external-link">STATSGO2
Documentation</a>.</p>
<div style="padding: 10px; font-size:90%;">
<p>The Digital General Soil Map of the United States or STATSGO2 is a
broad-based inventory of soils and non-soil areas that occur in a
repeatable pattern on the landscape and that can be cartographically
shown at the scale mapped of 1:250,000 in the continental U.S., Hawaii,
Puerto Rico, and the Virgin Islands and 1:1,000,000 in Alaska. The level
of mapping is designed for broad planning and management uses covering
state, regional, and multi-state areas. The U.S. General Soil Map is
comprised of general soil association units and is maintained and
distributed as a spatial and tabular dataset.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="thematic-mapping">Thematic Mapping<a class="anchor" aria-label="anchor" href="#thematic-mapping"></a>
</h3>
<p>Thematic mapping or analysis of soil information requires connecting
the grids to our tabular data sources, either using local files or Soil
Data Access (SDA) web-service. The <code>soilDB</code> package provides
many convenient interfaces to SDA. Note that SDA does not yet contain
tabular data for the raster soil surveys.</p>
</div>
<div class="section level3">
<h3 id="caveats-limitations">Caveats / Limitations<a class="anchor" aria-label="anchor" href="#caveats-limitations"></a>
</h3>
<ul>
<li>Requests are limited to images sizes of 5000x5000 pixels, this is
approximately 1 degree x 1 degree (longitude, latitude) at 30m.</li>
</ul>
</div>
<div class="section level3">
<h3 id="web-coverage-service-requests-using-bounding-boxes">Web Coverage Service Requests Using Bounding Boxes<a class="anchor" aria-label="anchor" href="#web-coverage-service-requests-using-bounding-boxes"></a>
</h3>
<p>A buffer applied to a <a href="https://casoilresource.lawr.ucdavis.edu/gmap/?loc=36.52578,-118.55639,z13" class="external-link">single
WGS84 coordinate</a> can be used to create a bounding box (BBOX):</p>
<p>We can create a terra SpatVector containing the single point, then
create a 1000m radius circular polygon around the point with
<code><a href="https://rdrr.io/pkg/terra/man/buffer.html" class="external-link">buffer()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ncss-tech.github.io/soilDB/" class="external-link">soilDB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># example point, WGS84 coordinates</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    lon <span class="op">=</span> <span class="op">-</span><span class="fl">118.55639</span>,</span>
<span>    lat <span class="op">=</span> <span class="fl">36.52578</span></span>
<span>  <span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1000m buffer applied to WGS84 coordinate</span></span>
<span><span class="co"># radius defined in meters</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/buffer.html" class="external-link">buffer</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># query WCS</span></span>
<span><span class="co"># result is in EPSG:5070</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span><span class="va">b</span>, db <span class="op">=</span> <span class="st">'gSSURGO'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># inspect</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/metags.html" class="external-link">metags</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">[</span><span class="st">'description'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add buffer, after transforming to mukey grid CRS</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">b</span>, <span class="st">"EPSG:5070"</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add original point, after transforming to mukey grid CRS</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"EPSG:5070"</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="section level4">
<h4 id="manual-creation-of-bounding-boxes">Manual Creation of Bounding Boxes<a class="anchor" aria-label="anchor" href="#manual-creation-of-bounding-boxes"></a>
</h4>
<p>Sometimes it is convenient to specify a BBOX created from a website
or single point specified in WGS84 coordinates. Arbitrary spatial
objects can be used as input. <a href="https://casoilresource.lawr.ucdavis.edu/gmap/" class="external-link">SoilWeb</a>
provides two keyboard shortcuts in the map interface:</p>
<ul>
<li><p>Press <code>'b'</code> to copy the current bounding box
coordinates, returned as: <span style="font-size: 80%;"><tt>-118.6609
36.4820,-118.6609 36.5972,-118.3979 36.5972,-118.3979 36.4820,-118.6609
36.4820</tt></span>. These five coordinates pairs form a rectangular
polygon, the geometry of which can be represented as <a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry" class="external-link">Well-Known
Text</a>.</p></li>
<li><p>Press <code>'p'</code> copy link to center coordinate, returned
as:
<code>https://casoilresource.lawr.ucdavis.edu/gmap/?loc=36.53964,-118.52943,z13</code></p></li>
</ul>
<p>Right-clicking anywhere in the map interface will also generate a
link to those coordinates and zoom level.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ncss-tech.github.io/soilDB/" class="external-link">soilDB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># paste the five coordinates comprising the BBOX polygon here</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="st">'-118.6609 36.4820,-118.6609 36.5972,-118.3979 36.5972,-118.3979 36.4820,-118.6609 36.4820'</span></span>
<span></span>
<span><span class="co"># convert WKT string -&gt; sfc geometry</span></span>
<span><span class="va">wkt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'POLYGON((%s))'</span>, <span class="va">bb</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">wkt</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set coordinate reference system as GCS/WGS84</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">4326</span></span>
<span></span>
<span><span class="co"># query WCS</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span><span class="va">x</span>, db <span class="op">=</span> <span class="st">'gSSURGO'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># inspect</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/metags.html" class="external-link">metags</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">[</span><span class="st">'description'</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add original BBOX, after transforming to mukey grid CRS</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">5070</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="map-unit-key-grids">Map Unit Key Grids<a class="anchor" aria-label="anchor" href="#map-unit-key-grids"></a>
</h2>
<p>Use the <code><a href="../reference/mukey.wcs.html">mukey.wcs()</a></code> function to access chunks of the
CONUS “map unit key” grids. The area of interest (AOI) can be defined
manually, as below, or automatically extracted from <code>sf</code>,
<code>sfc</code>, <code>bbox</code>, <code>SpatRaster</code>,
<code>SpatVector</code>, <code>Spatial*</code> or
<code>RasterLayer</code> objects.</p>
<p>The resulting grid of integers (<code>mukey</code>; or map unit key)
represents unique map units within specific soil survey areas; the grid
isn’t all that useful by itself.</p>
<p>To make the grids more useful, join data from Soil Data Access (SDA)
or local files to create thematic maps based on the map unit key. SSURGO
data for specific soil components, depths, and properties within a map
unit can be aggregated so the aggregate values are 1:1 with
<code>mukey</code>, then the resulting values can be used to symbolize
the map.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make a bounding box and assign a CRS (4326: GCS, WGS84)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">114.16</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">114.08</span>, ymin <span class="op">=</span> <span class="fl">47.65</span>, ymax <span class="op">=</span> <span class="fl">47.68</span><span class="op">)</span>, </span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fetch gSSURGO map unit keys at native resolution (30m)</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">a</span>, db <span class="op">=</span> <span class="st">'gssurgo'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 147, 219, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 30, 30  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -1365495, -1358925, 2869245, 2873655  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : NAD83 / Conus Albers (EPSG:5070) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : file21b8521a9a72 </span></span>
<span><span class="co">#&gt; categories  : mukey </span></span>
<span><span class="co">#&gt; name        :   mukey </span></span>
<span><span class="co">#&gt; min value   :  144983 </span></span>
<span><span class="co">#&gt; max value   : 1716001</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">mu</span>, </span>
<span>  main <span class="op">=</span> <span class="st">'gSSURGO map unit keys'</span>,</span>
<span>  sub <span class="op">=</span> <span class="st">'Albers Equal Area Projection'</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="ssurgo-polygons-from-sda">SSURGO Polygons from SDA<a class="anchor" aria-label="anchor" href="#ssurgo-polygons-from-sda"></a>
</h3>
<p>It is possible to retrieve vector geometries from SDA with the
<code><a href="../reference/SDA_spatialQuery.html">SDA_spatialQuery()</a></code> function. Standard SSURGO map unit
polygons can be obtained in addition to soil survey area polygons and
STATSGO map unit polygons.</p>
<p>The vector data are stored and delivered in a geographic coordinate
system (WGS84), whereas the WCS grids generally use a locally relevant
projected coordinate system (<code>"EPSG:5070"</code> in CONUS).
Overlaying SSURGO polygons and map unit key grids will therefore require
a simple transformation.</p>
<p>First get intersecting SSURGO polygons from SDA with
<code><a href="../reference/SDA_spatialQuery.html">SDA_spatialQuery()</a></code></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># because mu is a SpatRaster, result is a SpatVector object (GCS WGS84)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDA_spatialQuery.html">SDA_spatialQuery</a></span><span class="op">(</span><span class="va">mu</span>, what <span class="op">=</span> <span class="st">'mupolygon'</span>, geomIntersection <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Then transform to AEA coordinate reference system used by CONUS
gSSURGO / gNATSGO (<code>"EPSG:5070"</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Inspect the result by overlaying SSURGO polygons on the 30m map unit
key grid.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu</span>,</span>
<span>     main <span class="op">=</span> <span class="st">'gSSURGO Grid (WCS)\nSSURGO Polygons (SDA)'</span>,</span>
<span>     axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, border <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">'CONUS Albers Equal Area Projection (EPSG:5070)'</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-10-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="grid-resolution-specification">Grid Resolution Specification<a class="anchor" aria-label="anchor" href="#grid-resolution-specification"></a>
</h3>
<p>Requesting map unit key grids at a resolution other than 30m is
possible, but only suitable for a quick “preview” of the data.</p>
<p>For example, it is possible to get a larger areal extent of data by
requesting grids at coarser resolution (e.g. 800m).</p>
<p>However, the pixels represent categories (unique map units) and are
selected by nearest-neighbor; there is no other generalization used to
convert the source 30m grid to the coarser scale. A coarser
representation of data can be used for inspection of general patterns.
Detailed analysis should be based on derived property data sets
aggregated up from 30m results.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make a bounding box (in California) and assign a CRS (GCS WGS84 / EPSG:4326)</span></span>
<span><span class="va">a.CA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  xmin <span class="op">=</span> <span class="op">-</span><span class="fl">121</span>,</span>
<span>  xmax <span class="op">=</span> <span class="op">-</span><span class="fl">120</span>,</span>
<span>  ymin <span class="op">=</span> <span class="fl">37</span>,</span>
<span>  ymax <span class="op">=</span> <span class="fl">38</span></span>
<span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fetch gSSURGO map unit keys at ~800m</span></span>
<span><span class="co"># nearest-neighbor resampling = this is a "preview"</span></span>
<span><span class="co"># result is a SpatRaster object</span></span>
<span><span class="va">x.800</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">a.CA</span>, db <span class="op">=</span> <span class="st">'gssurgo'</span>, res <span class="op">=</span> <span class="fl">800</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x.800</span>,</span>
<span>  main <span class="op">=</span> <span class="st">'A Preview of gSSURGO Map Unit Keys'</span>,</span>
<span>  sub <span class="op">=</span> <span class="st">'Albers Equal Area Projection (800m)\nnearest-neighbor resampling'</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-11-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="raster-soil-survey-data">Raster Soil Survey Data<a class="anchor" aria-label="anchor" href="#raster-soil-survey-data"></a>
</h3>
<p>The specific RSS (state-level) data sets can be downloaded (map unit
key grids, tabular data) on Box:
<code>https://nrcs.app.box.com/v/soils</code>. Please note that tabular
data for Raster Soil Surveys are not yet available via Soil Data
Access.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Coweeta Hydrologic Laboratory extent; specified in EPSG:5070</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">1129000</span>, xmax <span class="op">=</span> <span class="fl">1135000</span>, ymin <span class="op">=</span> <span class="fl">1403000</span>, ymax <span class="op">=</span> <span class="fl">1411000</span><span class="op">)</span>, </span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">5070</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert boundary sf polygon</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># gSSURGO grid: 30m resolution</span></span>
<span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span><span class="va">a</span>, db <span class="op">=</span> <span class="st">'gSSURGO'</span>, res <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 267, 200, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 30, 30  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 1129005, 1135005, 1402995, 1411005  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : NAD83 / Conus Albers (EPSG:5070) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : file21b81f596cf2 </span></span>
<span><span class="co">#&gt; categories  : mukey </span></span>
<span><span class="co">#&gt; name        :  mukey </span></span>
<span><span class="co">#&gt; min value   : 545800 </span></span>
<span><span class="co">#&gt; max value   : 545887</span></span>
<span></span>
<span><span class="co"># gNATSGO grid: 30m resolution</span></span>
<span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span><span class="va">a</span>, db <span class="op">=</span> <span class="st">'gNATSGO'</span>, res <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 267, 200, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 30, 30  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 1129005, 1135005, 1402995, 1411005  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : NAD83 / Conus Albers (EPSG:5070) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : file21b82fd5271a </span></span>
<span><span class="co">#&gt; categories  : mukey </span></span>
<span><span class="co">#&gt; name        :   mukey </span></span>
<span><span class="co">#&gt; min value   :  545800 </span></span>
<span><span class="co">#&gt; max value   : 3244759</span></span>
<span></span>
<span><span class="co"># RSS grid: 10m resolution</span></span>
<span><span class="op">(</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span><span class="va">a</span>, db <span class="op">=</span> <span class="st">'RSS'</span>, res <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 800, 600, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 10, 10.0125  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 1129005, 1135005, 1402995, 1411005  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : NAD83 / Conus Albers (EPSG:5070) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : file21b81b6085d7 </span></span>
<span><span class="co">#&gt; categories  : mukey </span></span>
<span><span class="co">#&gt; name        :   mukey </span></span>
<span><span class="co">#&gt; min value   : 3244721 </span></span>
<span><span class="co">#&gt; max value   : 3244759</span></span>
<span></span>
<span><span class="co"># graphical comparison</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># gSSURGO</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/metags.html" class="external-link">metags</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="st">'description'</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">a</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># gNATSGO</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/metags.html" class="external-link">metags</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="st">'description'</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">a</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RSS</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">z</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/metags.html" class="external-link">metags</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">[</span><span class="st">'description'</span><span class="op">]</span>,</span>
<span>  ext <span class="op">=</span> <span class="va">x</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">a</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="statsgo-1">STATSGO<a class="anchor" aria-label="anchor" href="#statsgo-1"></a>
</h3>
<p>Continuing from the example above, we can use
<code>db='statsgo'</code> to compare gSSURGO product with the Digital
General Soil Map of the United States (STATSGO2). STATSGO data are
provided at 10x the nominal resolution of gSSURGO (300m v.s. 30m) to
reflect the relative generality of this product.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">statsgo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span><span class="va">a</span>, db <span class="op">=</span> <span class="st">'statsgo'</span>, res <span class="op">=</span> <span class="fl">300</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 27, 20, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 300, 300  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 1129005, 1135005, 1402995, 1411095  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : NAD83 / Conus Albers (EPSG:5070) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : file21b86e8c63a1 </span></span>
<span><span class="co">#&gt; categories  : mukey </span></span>
<span><span class="co">#&gt; name        :  mukey </span></span>
<span><span class="co">#&gt; min value   : 659074 </span></span>
<span><span class="co">#&gt; max value   : 664845</span></span>
<span></span>
<span><span class="co"># graphical comparison</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># gSSURGO</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/metags.html" class="external-link">metags</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="st">'description'</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># STATSGO</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">statsgo</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/metags.html" class="external-link">metags</a></span><span class="op">(</span><span class="va">statsgo</span><span class="op">)</span><span class="op">[</span><span class="st">'description'</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="hawaii-ssurgo">Hawaii SSURGO<a class="anchor" aria-label="anchor" href="#hawaii-ssurgo"></a>
</h3>
<p>A new 30m SSURGO map unit key WCS based on the
<code>"EPSG:6628"</code> coordinate reference system has been added for
Hawaii.</p>
<p>The example bounding box is centered on the <a href="https://casoilresource.lawr.ucdavis.edu/gmap/?loc=21.97839,-159.61727,z13" class="external-link">southern
coast of Kauai</a>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># paste your BBOX text here</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="st">'-159.7426 21.9059,-159.7426 22.0457,-159.4913 22.0457,-159.4913 21.9059,-159.7426 21.9059'</span></span>
<span></span>
<span><span class="co"># convert WKT string -&gt; sfc geometry</span></span>
<span><span class="va">wkt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'POLYGON((%s))'</span>, <span class="va">bb</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">wkt</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># query WCS</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span><span class="va">x</span>, db <span class="op">=</span> <span class="st">'hi_ssurgo'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make NA (the ocean) blue</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">mu</span>,</span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/metags.html" class="external-link">metags</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">[</span><span class="st">'description'</span><span class="op">]</span>,</span>
<span>  colNA <span class="op">=</span> <span class="st">'royalblue'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-14-1.png" width="624" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="puerto-rico-ssurgo">Puerto Rico SSURGO<a class="anchor" aria-label="anchor" href="#puerto-rico-ssurgo"></a>
</h3>
<p>A new 30m SSURGO map unit key WCS based on the
<code>"EPSG:32161"</code> coordinate reference system has been added for
Puerto Rico.</p>
<p>The example bounding box is centered on the <a href="https://casoilresource.lawr.ucdavis.edu/gmap/?loc=18.24843,-65.67369,z13" class="external-link">eastern
coast of Puerto Rico</a>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># paste your BBOX text here</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="st">'-65.7741 18.1711,-65.7741 18.3143,-65.5228 18.3143,-65.5228 18.1711,-65.7741 18.1711'</span></span>
<span></span>
<span><span class="co"># convert WKT string -&gt; sfc geometry</span></span>
<span><span class="va">wkt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'POLYGON((%s))'</span>, <span class="va">bb</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">wkt</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># query WCS</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span><span class="va">x</span>, db <span class="op">=</span> <span class="st">'pr_ssurgo'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make missing data (NA; the ocean) blue</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">mu</span>,</span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/metags.html" class="external-link">metags</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">[</span><span class="st">'description'</span><span class="op">]</span>,</span>
<span>  colNA <span class="op">=</span> <span class="st">'royalblue'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-16-1.png" width="624" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="thematic-mapping-1">Thematic Mapping<a class="anchor" aria-label="anchor" href="#thematic-mapping-1"></a>
</h2>
<p>The following example BBOX + resulting gSSURGO map unit key grid will
be used for thematic mapping examples:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make a bounding box and assign a CRS (4326: GCS, WGS84)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">114.16</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">114.08</span>, ymin <span class="op">=</span> <span class="fl">47.65</span>, ymax <span class="op">=</span> <span class="fl">47.68</span><span class="op">)</span>, </span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert bbox to sf geometry</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fetch gSSURGO map unit keys at native resolution (~30m)</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">a</span>, db <span class="op">=</span> <span class="st">'gssurgo'</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="map-unit-aggregate-values">Map Unit Aggregate Values<a class="anchor" aria-label="anchor" href="#map-unit-aggregate-values"></a>
</h3>
<p>The “Mapunit Aggregate Attribute” table records a variety of soil
attributes and interpretations that have been aggregated from the
component level to a single value at the map unit level. They have been
aggregated by one or more appropriate means in order to express a
consolidated value or interpretation for the map unit as a whole.</p>
<p>Use the <code><a href="../reference/get_SDA_muaggatt.html">get_SDA_muaggatt()</a></code> function, or write a query in
SQL and submit via <code><a href="../reference/SDA_query.html">SDA_query()</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># copy example grid</span></span>
<span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="va">mu</span></span>
<span></span>
<span><span class="co"># extract raster attribute table for thematic mapping</span></span>
<span><span class="op">(</span><span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;         ID   mukey</span></span>
<span><span class="co">#&gt; 1   144983  144983</span></span>
<span><span class="co">#&gt; 2   144984  144984</span></span>
<span><span class="co">#&gt; 3   144985  144985</span></span>
<span><span class="co">#&gt; 4   144986  144986</span></span>
<span><span class="co">#&gt; 5   145005  145005</span></span>
<span><span class="co">#&gt; 6   145009  145009</span></span>
<span><span class="co">#&gt; 7   145010  145010</span></span>
<span><span class="co">#&gt; 8   145011  145011</span></span>
<span><span class="co">#&gt; 9   145012  145012</span></span>
<span><span class="co">#&gt; 10  145015  145015</span></span>
<span><span class="co">#&gt; 11  145017  145017</span></span>
<span><span class="co">#&gt; 12  145019  145019</span></span>
<span><span class="co">#&gt; 13  145020  145020</span></span>
<span><span class="co">#&gt; 14  145056  145056</span></span>
<span><span class="co">#&gt; 15  145057  145057</span></span>
<span><span class="co">#&gt; 16  145058  145058</span></span>
<span><span class="co">#&gt; 17  145059  145059</span></span>
<span><span class="co">#&gt; 18  145060  145060</span></span>
<span><span class="co">#&gt; 19  145068  145068</span></span>
<span><span class="co">#&gt; 20  145069  145069</span></span>
<span><span class="co">#&gt; 21  145070  145070</span></span>
<span><span class="co">#&gt; 22  145076  145076</span></span>
<span><span class="co">#&gt; 23  145079  145079</span></span>
<span><span class="co">#&gt; 24  145118  145118</span></span>
<span><span class="co">#&gt; 25  145183  145183</span></span>
<span><span class="co">#&gt; 26  145195  145195</span></span>
<span><span class="co">#&gt; 27  145208  145208</span></span>
<span><span class="co">#&gt; 28  145250  145250</span></span>
<span><span class="co">#&gt; 29  145253  145253</span></span>
<span><span class="co">#&gt; 30  145264  145264</span></span>
<span><span class="co">#&gt; 31  145269  145269</span></span>
<span><span class="co">#&gt; 32  145275  145275</span></span>
<span><span class="co">#&gt; 33  145278  145278</span></span>
<span><span class="co">#&gt; 34  145328  145328</span></span>
<span><span class="co">#&gt; 35  145329  145329</span></span>
<span><span class="co">#&gt; 36  145340  145340</span></span>
<span><span class="co">#&gt; 37  145343  145343</span></span>
<span><span class="co">#&gt; 38  145385  145385</span></span>
<span><span class="co">#&gt; 39 1715935 1715935</span></span>
<span><span class="co">#&gt; 40 1716001 1716001</span></span>
<span></span>
<span><span class="co"># optionally use convenience function:</span></span>
<span><span class="co"># * returns all fields from muaggatt table</span></span>
<span><span class="co"># * along with map unit name</span></span>
<span><span class="co"># tab &lt;- get_SDA_muaggatt(mukeys = as.numeric(rat$mukey), query_string = TRUE)</span></span>
<span></span>
<span><span class="va">.sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"SELECT mukey, aws050wta, aws0100wta FROM muaggatt WHERE mukey IN "</span>,</span>
<span>  <span class="fu"><a href="../reference/format_SQL_in_statement.html">format_SQL_in_statement</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">rat</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run query, result is a data.frame</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDA_query.html">SDA_query</a></span><span class="op">(</span><span class="va">.sql</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt;    mukey aws050wta aws0100wta</span></span>
<span><span class="co">#&gt; 1 144983      7.26      14.02</span></span>
<span><span class="co">#&gt; 2 144984      7.31      14.14</span></span>
<span><span class="co">#&gt; 3 144985      7.36      14.27</span></span>
<span><span class="co">#&gt; 4 144986      7.06      13.19</span></span>
<span><span class="co">#&gt; 5 145005      5.21       9.34</span></span>
<span><span class="co">#&gt; 6 145009      5.49       9.16</span></span>
<span></span>
<span><span class="co"># set raster categories</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tab</span></span>
<span></span>
<span><span class="co"># convert grid + RAT -&gt; stack of property grids</span></span>
<span><span class="va">aws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/catalyze.html" class="external-link">catalyze</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot, set a common range [0, 20] for both layers</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">aws</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cex.main <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'Plant Available Water Storage (cm)\nWeighted Mean over Components, 0-50cm'</span>,</span>
<span>    <span class="st">'Plant Available Water Storage (cm)\nWeighted Mean over Components, 0-100cm'</span></span>
<span>  <span class="op">)</span>,</span>
<span>  range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-19-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="interpretations-for-soil-suitability-limitation">Interpretations for Soil Suitability / Limitation<a class="anchor" aria-label="anchor" href="#interpretations-for-soil-suitability-limitation"></a>
</h3>
<p>You can use the <code><a href="../reference/get_SDA_interpretation.html">get_SDA_interpretation()</a></code> function to
return interpretation ratings for specific components, or aggregated up
to the map unit level. Here, we produce maps using two interpretation
rules: <code>'ENG - Construction Materials; Roadfill'</code>, and
<code>'AWM - Irrigation Disposal of Wastewater'</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># copy example grid</span></span>
<span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="va">mu</span></span>
<span></span>
<span><span class="co"># extract RAT for thematic mapping</span></span>
<span><span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ENG - Construction Materials; Roadfill'</span>,</span>
<span>           <span class="st">'AWM - Irrigation Disposal of Wastewater'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_SDA_interpretation.html">get_SDA_interpretation</a></span><span class="op">(</span></span>
<span>  rulename <span class="op">=</span> <span class="va">rules</span>, </span>
<span>  method <span class="op">=</span> <span class="st">"Weighted Average"</span>, </span>
<span>  mukeys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">rat</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt;   areasymbol musym                                                               muname  mukey</span></span>
<span><span class="co">#&gt; 1      MT629   101                      McCollum fine sandy loam, 0 to 2 percent slopes 144983</span></span>
<span><span class="co">#&gt; 2      MT629   102                      McCollum fine sandy loam, 2 to 4 percent slopes 144984</span></span>
<span><span class="co">#&gt; 3      MT629   103                      McCollum fine sandy loam, 4 to 8 percent slopes 144985</span></span>
<span><span class="co">#&gt; 4      MT629   104 McCollum fine sandy loam, gravelly substratum, 0 to 2 percent slopes 144986</span></span>
<span><span class="co">#&gt; 5      MT629   120                         Niarada gravelly loam, 0 to 4 percent slopes 145005</span></span>
<span><span class="co">#&gt; 6      MT629   123                 Niarada gravelly loam, cool, 15 to 30 percent slopes 145009</span></span>
<span><span class="co">#&gt;   rating_ENGConstructionMaterialsRoadfill rating_AWMIrrigationDisposalofWastewater</span></span>
<span><span class="co">#&gt; 1                                    1.00                                     0.00</span></span>
<span><span class="co">#&gt; 2                                    0.98                                     0.05</span></span>
<span><span class="co">#&gt; 3                                    0.98                                     0.68</span></span>
<span><span class="co">#&gt; 4                                    1.00                                     0.15</span></span>
<span><span class="co">#&gt; 5                                    0.98                                     0.19</span></span>
<span><span class="co">#&gt; 6                                    0.12                                     1.00</span></span>
<span><span class="co">#&gt;   class_ENGConstructionMaterialsRoadfill class_AWMIrrigationDisposalofWastewater</span></span>
<span><span class="co">#&gt; 1                            Well suited                             Not limited</span></span>
<span><span class="co">#&gt; 2                 Moderately well suited                        Slightly limited</span></span>
<span><span class="co">#&gt; 3                 Moderately well suited                      Moderately limited</span></span>
<span><span class="co">#&gt; 4                            Well suited                        Slightly limited</span></span>
<span><span class="co">#&gt; 5                 Moderately well suited                        Slightly limited</span></span>
<span><span class="co">#&gt; 6                          Poorly suited                            Very limited</span></span>
<span><span class="co">#&gt;                                                     reason_ENGConstructionMaterialsRoadfill</span></span>
<span><span class="co">#&gt; 1                                                                                      &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2                                                       Low strength (0.778); Dusty (0.785)</span></span>
<span><span class="co">#&gt; 3                                                       Low strength (0.778); Dusty (0.785)</span></span>
<span><span class="co">#&gt; 4                                                                                      &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5                                               Dusty (0.981); Dusty (0.981); Dusty (0.902)</span></span>
<span><span class="co">#&gt; 6 Slope (0.08); Dusty (0.975); Slope (0.08); Dusty (0.981); Depth to bedrock (0); Slope (0)</span></span>
<span><span class="co">#&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         reason_AWMIrrigationDisposalofWastewater</span></span>
<span><span class="co">#&gt; 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2                                                                                                                                                                                                                                                                                                                                                                                                                                                               Filtering capacity (1); Too steep for surface application (0.08)</span></span>
<span><span class="co">#&gt; 3                                                                                                                                                                                                                                                                                                                                                                                                                                             Too steep for surface application (0.68); Too steep for surface application (0.68)</span></span>
<span><span class="co">#&gt; 4                                                                                                                                                                                                                                                                                                                                                                                                                                                               Filtering capacity (1); Filtering capacity (1); Droughty (0.918)</span></span>
<span><span class="co">#&gt; 5                                                                                                                                                                                                                                                                                                                                                                                 Droughty (0.133); Large stones on the surface (0.141); Droughty (0.117); Filtering capacity (1); Droughty (0.918); Slow water movement (0.372)</span></span>
<span><span class="co">#&gt; 6 Too steep for surface application (1); Too steep for sprinkler application (1); Droughty (0.061); Too steep for surface application (1); Too steep for sprinkler application (1); Large stones on the surface (0.141); Droughty (0.117); Droughty (1); Too steep for surface application (1); Too steep for sprinkler application (1); Depth to bedrock (1); Large stones on the surface (0.684); Filtering capacity (1); Too steep for surface application (1); Droughty (0.918); Too steep for sprinkler application (0.395)</span></span>
<span></span>
<span><span class="co"># set ordered factor levels (for nice label/legend order)</span></span>
<span><span class="va">tab</span><span class="op">$</span><span class="va">class_ENGConstructionMaterialsRoadfill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="va">tab</span><span class="op">$</span><span class="va">class_ENGConstructionMaterialsRoadfill</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'Not suited'</span>,</span>
<span>    <span class="st">'Poorly suited'</span>,</span>
<span>    <span class="st">'Moderately suited'</span>,</span>
<span>    <span class="st">'Moderately well suited'</span>,</span>
<span>    <span class="st">'Well suited'</span>,</span>
<span>    <span class="st">'Not Rated'</span></span>
<span>  <span class="op">)</span>,</span>
<span>  ordered <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">12</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span></span>
<span>  <span class="va">rating_ENGConstructionMaterialsRoadfill</span> <span class="op">~</span> <span class="va">class_ENGConstructionMaterialsRoadfill</span>,</span>
<span>  cex.main <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  main <span class="op">=</span> <span class="st">'ENG - Construction Materials; Roadfill'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>  data <span class="op">=</span> <span class="va">tab</span>,</span>
<span>  horizontal <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># fuzzy ratings on X axis</span></span>
<span>  las <span class="op">=</span> <span class="fl">1</span>            <span class="co"># rotate axis labels 90 degrees</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-20-1.png" width="768" style="display: block; margin: auto;"></p>
<p>From above graph we can see that the different suitability rating
classes <code>class_ENGConstructionMaterialsRoadfill</code> each
correspond to a range of fuzzy values
(<code>rating_ENGConstructionMaterialsRoadfill</code>).</p>
<p>Next, we can view the ratings as a thematic map:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'rating_ENGConstructionMaterialsRoadfill'</span>,</span>
<span>  <span class="st">'rating_AWMIrrigationDisposalofWastewater'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set raster categories</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mukey'</span>, <span class="va">vars</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">rating</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/catalyze.html" class="external-link">catalyze</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># inspect</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">rating</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cex.main <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'Construction Materials; Roadfill\nWeighted Mean over Components'</span>,</span>
<span>    <span class="st">'Irrigation Disposal of Wastewater\nWeighted Mean over Components'</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-21-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="component-level-properties">Component-level Properties<a class="anchor" aria-label="anchor" href="#component-level-properties"></a>
</h3>
<p>Soil “components” are the members (land types) of a map unit. A map
unit may contain several distinct soil and non-soil areas.</p>
<p>A widely-used property which is calculated as a standard part of
SSURGO soil map unit components is the “steel corrosion potential”. Here
we also use <code><a href="../reference/get_SDV_legend_elements.html">get_SDV_legend_elements()</a></code> to get the standard
Soil Data Viewer colors for the selected property/interpretation.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># copy example grid</span></span>
<span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="va">mu</span></span>
<span></span>
<span><span class="co"># extract RAT for thematic mapping</span></span>
<span><span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_SDA_property.html">get_SDA_property</a></span><span class="op">(</span>property <span class="op">=</span> <span class="st">'Corrosion of Steel'</span>, </span>
<span>                        method <span class="op">=</span> <span class="st">'DOMINANT CONDITION'</span>,</span>
<span>                        mukeys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">rat</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span>,</span>
<span>                        miscellaneous_areas <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get soil data viewer standard colors for corsteel</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_SDV_legend_elements.html">get_SDV_legend_elements</a></span><span class="op">(</span><span class="st">"attributecolumnname = 'corsteel'"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set raster categories</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mukey'</span>, <span class="st">'corsteel'</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># set active category</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/activeCat.html" class="external-link">activeCat</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'corsteel'</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">mu2</span>,</span>
<span>  col <span class="op">=</span> <span class="va">cols</span><span class="op">$</span><span class="va">hex</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/na.omit.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tab</span><span class="op">$</span><span class="va">corsteel</span><span class="op">)</span>, <span class="va">cols</span><span class="op">$</span><span class="va">label</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  legend <span class="op">=</span> <span class="st">"topleft"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-22-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Another example is thematic mapping of the “simplified component
parent material group”. First, set up a new AOI for the following
examples:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># https://casoilresource.lawr.ucdavis.edu/gmap/?loc=36.57666,-96.70175,z14</span></span>
<span><span class="co"># make a bounding box and assign a CRS (4326: GCS, WGS84)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">96.7696</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">96.6477</span>, </span>
<span>    ymin <span class="op">=</span> <span class="fl">36.5477</span>, ymax <span class="op">=</span> <span class="fl">36.6139</span><span class="op">)</span>, </span>
<span>  crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fetch gSSURGO map unit keys at native resolution (~30m)</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">a</span>, db <span class="op">=</span> <span class="st">'gssurgo'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">mu</span>, </span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  cex.main <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  main <span class="op">=</span> <span class="st">'gSSURGO Map Unit Key Grid'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-23-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We use <code><a href="../reference/get_SDA_pmgroupname.html">get_SDA_pmgroupname()</a></code> to obtain the tabular
parent material information to relate to map unit keys:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># copy example grid</span></span>
<span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="va">mu</span></span>
<span></span>
<span><span class="co"># extract RAT for thematic mapping</span></span>
<span><span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># simplified parent material group name</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_SDA_pmgroupname.html">get_SDA_pmgroupname</a></span><span class="op">(</span>mukeys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">rat</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span>,</span>
<span>                           miscellaneous_areas <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set raster categories</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mukey'</span>, <span class="st">'pmgroupname'</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># set active category</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/activeCat.html" class="external-link">activeCat</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'pmgroupname'</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu2</span>, legend <span class="op">=</span> <span class="st">"topleft"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-24-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We can also inspect a mapunit-level hydric rating derived from the
default aggregation method in <code><a href="../reference/get_SDA_hydric.html">get_SDA_hydric()</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># copy example grid</span></span>
<span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="va">mu</span></span>
<span></span>
<span><span class="co"># extract RAT for thematic mapping</span></span>
<span><span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># simplified parent material group name</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_SDA_hydric.html">get_SDA_hydric</a></span><span class="op">(</span>mukeys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">rat</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mukey'</span>, <span class="st">'HYDRIC_RATING'</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># set active category </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/activeCat.html" class="external-link">activeCat</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'HYDRIC_RATING'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu2</span>, legend <span class="op">=</span> <span class="st">"topleft"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-25-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="several-horizon-level-soil-properties">Several Horizon-level Soil Properties<a class="anchor" aria-label="anchor" href="#several-horizon-level-soil-properties"></a>
</h3>
<p>The <a href="http://ncss-tech.github.io/soilDB/reference/get_SDA_property.html"><code>get_SDA_property()</code></a>
function from <code>soilDB</code> is a general interface to aggregated
SSURGO/STATSGO tabular data via SDA. It was used to obtain a
component-level property previously (steel corrosion), and now we will
use it to aggregate several horizon-level property values for a specific
depth interval.</p>
<p>Derive aggregate soil properties, merge with raster attribute table
(RAT).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract RAT for thematic mapping</span></span>
<span><span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># variables of interest</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dbthirdbar_r"</span>, <span class="st">"awc_r"</span>, <span class="st">"ph1to1h2o_r"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get / aggregate specific horizon-level properties from SDA</span></span>
<span><span class="co"># be sure to see the manual page for this function</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_SDA_property.html">get_SDA_property</a></span><span class="op">(</span>property <span class="op">=</span> <span class="va">vars</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"Dominant Component (Numeric)"</span>, </span>
<span>                        mukeys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">rat</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span>,</span>
<span>                        top_depth <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                        bottom_depth <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># check</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt;    mukey areasymbol musym                                                                   muname</span></span>
<span><span class="co">#&gt; 1 623396      OK113     1                          Apperson silty clay loam, 1 to 3 percent slopes</span></span>
<span><span class="co">#&gt; 2 623399      OK113     4                                        Coyle loam, 1 to 3 percent slopes</span></span>
<span><span class="co">#&gt; 3 623402      OK113     7 Keokuk very fine sandy loam, 0 to 1 percent slopes, occasionally flooded</span></span>
<span><span class="co">#&gt; 4 623405      OK113    10                                 Bethany silt loam, 1 to 3 percent slopes</span></span>
<span><span class="co">#&gt; 5 623406      OK113    11                                 Bethany silt loam, 3 to 5 percent slopes</span></span>
<span><span class="co">#&gt; 6 623407      OK113    12                          Bethany-Pawhuska complex, 1 to 5 percent slopes</span></span>
<span><span class="co">#&gt;   dbthirdbar_r awc_r ph1to1h2o_r</span></span>
<span><span class="co">#&gt; 1         1.45  0.18        6.15</span></span>
<span><span class="co">#&gt; 2         1.40  0.18        5.70</span></span>
<span><span class="co">#&gt; 3         1.43  0.17        7.30</span></span>
<span><span class="co">#&gt; 4         1.35  0.20        6.20</span></span>
<span><span class="co">#&gt; 5         1.30  0.20        6.30</span></span>
<span><span class="co">#&gt; 6         1.34  0.20        6.30</span></span>
<span></span>
<span><span class="co"># convert areasymbol into a factor easy plotting later</span></span>
<span><span class="va">tab</span><span class="op">$</span><span class="va">areasymbol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">tab</span><span class="op">$</span><span class="va">areasymbol</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set raster categories</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mukey'</span>, <span class="va">vars</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># list variables in the RAT</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mukey"        "dbthirdbar_r" "awc_r"        "ph1to1h2o_r"</span></span>
<span></span>
<span><span class="co"># convert categories associated with keys to values</span></span>
<span><span class="va">mu2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/catalyze.html" class="external-link">catalyze</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span></code></pre></div>
<p>Inspect just the plant available water 0-25cm.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">$</span><span class="va">awc_r</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-27-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Plot aggregate soil properties.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">[[</span><span class="st">'dbthirdbar_r'</span><span class="op">]</span><span class="op">]</span>, cex.main <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>     main <span class="op">=</span> <span class="st">'1/3 Bar Bulk Density (g/cm^3)\nDominant Component\n0-25cm'</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-28-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">[[</span><span class="st">'awc_r'</span><span class="op">]</span><span class="op">]</span>, cex.main <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>     main <span class="op">=</span> <span class="st">'AWC (cm/cm)\nDominant Component\n0-25cm'</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-28-2.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu2</span><span class="op">[[</span><span class="st">'ph1to1h2o_r'</span><span class="op">]</span><span class="op">]</span>, cex.main <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>     main <span class="op">=</span> <span class="st">'pH 1:1 H2O\nDominant Component\n0-25cm'</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-28-3.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="sand-silt-and-clay-at-a-soil-survey-area-boundary">Sand, Silt, and Clay at a Soil Survey Area Boundary<a class="anchor" aria-label="anchor" href="#sand-silt-and-clay-at-a-soil-survey-area-boundary"></a>
</h3>
<p>Here is an example of not so great exact join between soil survey
areas. In this case the one soil survey was published in 1979 and the
other in 2004.</p>
<p>First, we setup BBOX and query map unit key WCS.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract a BBOX like this from SoilWeb by pressing "b"</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="st">'-91.6853 36.4617,-91.6853 36.5281,-91.5475 36.5281,-91.5475 36.4617,-91.6853 36.4617'</span></span>
<span><span class="va">wkt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'POLYGON((%s))'</span>, <span class="va">bb</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># init sf object from WKT</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">wkt</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get gSSURGO grid here</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mukey.wcs.html">mukey.wcs</a></span><span class="op">(</span>aoi <span class="op">=</span> <span class="va">x</span>, db <span class="op">=</span> <span class="st">'gssurgo'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note SSA boundary</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-29-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Then we derive aggregate sand, silt, clay (RV) values from the
largest component, taking the weighted mean over 25-50cm depth interval.
We also will take the sand and clay values to calculate the surface
texture class for comparison.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract RAT for thematic mapping</span></span>
<span><span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">cats</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># variables of interest</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sandtotal_r"</span>, <span class="st">"silttotal_r"</span>, <span class="st">"claytotal_r"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get thematic data from SDA</span></span>
<span><span class="co"># dominant component</span></span>
<span><span class="co"># depth-weighted average</span></span>
<span><span class="co"># sand, silt, clay (RV)</span></span>
<span><span class="va">tab</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/get_SDA_property.html">get_SDA_property</a></span><span class="op">(</span>property <span class="op">=</span> <span class="va">vars</span>,</span>
<span>                         method <span class="op">=</span> <span class="st">"Dominant Component (Numeric)"</span>, </span>
<span>                         mukeys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">rat</span><span class="op">$</span><span class="va">mukey</span><span class="op">)</span>,</span>
<span>                         top_depth <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                         bottom_depth <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># check</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt;     mukey areasymbol musym                                                              muname</span></span>
<span><span class="co">#&gt; 1  691980      MO091 73306               Gressy-Gatewood complex, 3 to 8 percent slopes, rocky</span></span>
<span><span class="co">#&gt; 2 2502332      MO149 73321                       Alred-Gatewood complex, 1 to 8 percent slopes</span></span>
<span><span class="co">#&gt; 3 2502334      MO149 73322                      Alred-Gatewood complex, 8 to 15 percent slopes</span></span>
<span><span class="co">#&gt; 4 2503322      MO149 76002 Batcave-Farewell complex, 1 to 3 percent slopes, frequently flooded</span></span>
<span><span class="co">#&gt; 5 2503473      MO149 76046             Secesh silt loam, 1 to 3 percent slopes, rarely flooded</span></span>
<span><span class="co">#&gt; 6 2503476      MO149 76047    Secesh-Tilk complex, 1 to 3 percent slopes, occasionally flooded</span></span>
<span><span class="co">#&gt;   sandtotal_r silttotal_r claytotal_r</span></span>
<span><span class="co">#&gt; 1       23.00       59.00       18.00</span></span>
<span><span class="co">#&gt; 2       28.69       51.11       20.20</span></span>
<span><span class="co">#&gt; 3       28.69       51.11       20.20</span></span>
<span><span class="co">#&gt; 4       40.00       40.00       20.00</span></span>
<span><span class="co">#&gt; 5       25.65       49.00       25.35</span></span>
<span><span class="co">#&gt; 6       26.91       48.08       25.02</span></span>
<span></span>
<span><span class="co"># set raster categories</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mukey'</span>, <span class="va">vars</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># convert mukey grid + RAT -&gt; stack of numerical grids</span></span>
<span><span class="co"># retaining only sand, silt, clay via [[vars]]</span></span>
<span><span class="va">ssc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/catalyze.html" class="external-link">catalyze</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a copy of the grid</span></span>
<span><span class="va">texture.class</span> <span class="op">&lt;-</span> <span class="va">ssc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">texture.class</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'soil.texture'</span></span>
<span></span>
<span><span class="co"># assign soil texture classes for the fine earth fraction</span></span>
<span><span class="co"># using sand and clay percentages</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">texture.class</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">aqp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/texture.html" class="external-link">ssc_to_texcl</a></span><span class="op">(</span></span>
<span>  sand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">ssc</span><span class="op">[[</span><span class="st">'sandtotal_r'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>  clay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">ssc</span><span class="op">[[</span><span class="st">'claytotal_r'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>  droplevels <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ssc</span>, <span class="va">texture.class</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># graphical check</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">r</span>,</span>
<span>  cex.main <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="st">" - 25-50cm\nDominant Component"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="wcs-ssurgo_files/figure-html/unnamed-chunk-30-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker, Andrew Brown.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
