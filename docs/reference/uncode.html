<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Convert coded values returned from NASIS and SDA queries to factors — uncode • soilDB</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Convert coded values returned from NASIS and SDA queries to factors — uncode" />
<meta property="og:description" content="These functions convert the coded values returned from NASIS or SDA to
factors (e.g. 1 = Alfisols) using the metadata tables from NASIS. For SDA
the metadata is pulled from a static snapshot in the soilDB package
(/data/metadata.rda)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">soilDB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.6.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ncss-tech/soilDB/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert coded values returned from NASIS and SDA queries to factors</h1>
    <small class="dont-index">Source: <a href='https://github.com/ncss-tech/soilDB/blob/master/R/uncode.R'><code>R/uncode.R</code></a></small>
    <div class="hidden name"><code>uncode.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These functions convert the coded values returned from NASIS or SDA to
factors (e.g. 1 = Alfisols) using the metadata tables from NASIS. For SDA
the metadata is pulled from a static snapshot in the soilDB package
(/data/metadata.rda).</p>
    </div>

    <pre class="usage"><span class='fu'>uncode</span><span class='op'>(</span>
  <span class='va'>df</span>,
  invert <span class='op'>=</span> <span class='cn'>FALSE</span>,
  db <span class='op'>=</span> <span class='st'>"NASIS"</span>,
  droplevels <span class='op'>=</span> <span class='cn'>FALSE</span>,
  stringsAsFactors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>default.stringsAsFactors</a></span><span class='op'>(</span><span class='op'>)</span>,
  dsn <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>df</th>
      <td><p>data.frame</p></td>
    </tr>
    <tr>
      <th>invert</th>
      <td><p>converts the code labels back to their coded values (<code>FALSE</code>)</p></td>
    </tr>
    <tr>
      <th>db</th>
      <td><p>label specifying the soil database the data is coming from, which
indicates whether or not to query metadata from local NASIS database
("NASIS") or use soilDB-local snapshot ("LIMS" or "SDA")</p></td>
    </tr>
    <tr>
      <th>droplevels</th>
      <td><p>logical: indicating whether to drop unused levels in
classifying factors. This is useful when a class has large number of unused
classes, which can waste space in tables and figures.</p></td>
    </tr>
    <tr>
      <th>stringsAsFactors</th>
      <td><p>logical: should character vectors be converted to
factors?</p></td>
    </tr>
    <tr>
      <th>dsn</th>
      <td><p>Optional: path to local SQLite database containing NASIS
table structure; default: <code>NULL</code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame with the results.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>These functions convert the coded values returned from NASIS into their
plain text representation. It duplicates the functionality of the CODELABEL
function found in NASIS. This function is primarily intended to be used
internally by other soilDB R functions, in order to minimizes the need to
manually convert values.</p>
<p>The function works by iterating through the column names in a data frame and
looking up whether they match any of the ColumnPhysicalNames found in the
metadata domain tables. If matches are found then the columns coded values
are converted to their corresponding factor levels. Therefore it is not
advisable to reuse column names from NASIS unless the contents match the
range of values and format found in NASIS. Otherwise uncode() will convert
their values to NA.</p>
<p>When data is being imported from NASIS, the metadata tables are sourced
directly from NASIS. When data is being imported from SDA or the NASIS Web
Reports, the metadata is pulled from a static snapshot in the soilDB
package.</p>
<p>Beware the default is to return the values as factors rather than strings.
While strings are generally preferable, factors make plotting more
convenient. Generally the factor level ordering returned by uncode() follows
the naturally ordering of categories that would be expected (e.g. sand,
silt, clay).</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Stephen Roecker</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># \donttest{</span>
<span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"curl"</span><span class='op'>)</span> <span class='op'>&amp;</span>
    <span class='fu'>curl</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/curl/man/nslookup.html'>has_internet</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>&amp;</span>
    <span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/ncss-tech/aqp'>aqp</a></span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># query component by nationalmusym</span>
  <span class='va'>comp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fetchSDA.html'>fetchSDA</a></span><span class='op'>(</span>WHERE <span class='op'>=</span> <span class='st'>"nationalmusym = '2vzcp'"</span><span class='op'>)</span>
  <span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/aqp/man/site.html'>site</a></span><span class='op'>(</span><span class='va'>comp</span><span class='op'>)</span>

  <span class='co'># use SDA uncoding domain via db argument</span>
  <span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'>uncode</span><span class='op'>(</span><span class='va'>s</span>,  db<span class='op'>=</span><span class='st'>"SDA"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/pkg/raster/man/factor.html'>levels</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>taxorder</span><span class='op'>)</span>
<span class='op'>}</span>
</div><div class='output co'>#&gt; <span class='message'>single result set, returning a data.frame</span></div><div class='output co'>#&gt; <span class='message'>single result set, returning a data.frame</span></div><div class='output co'>#&gt; <span class='message'>single result set, returning a data.frame</span></div><div class='output co'>#&gt; <span class='message'>empty result set</span></div><div class='output co'>#&gt; <span class='message'>single result set, returning a data.frame</span></div><div class='output co'>#&gt; <span class='message'>single result set, returning a data.frame</span></div><div class='output co'>#&gt; <span class='message'>single result set, returning a data.frame</span></div><div class='output co'>#&gt; <span class='message'>single result set, returning a data.frame</span></div><div class='output co'>#&gt; <span class='message'>converting profile IDs from integer to character</span></div><div class='output co'>#&gt; <span class='message'>converting horizon IDs in column `chkey` to character</span></div><div class='output co'>#&gt; NULL</div><div class='input'><span class='co'># }</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker, Andrew Brown.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


